
================================================================================
ドキュメント: プログラム基本設計書_B145_累積作成_サブグループ別部品情報リストDOMファイルレコード生成_処理詳細_V9.pdf (PDF 1)
ファイル名: プログラム基本設計書_B145_累積作成_サブグループ別部品情報リストDOMファイルレコード生成_処理詳細_V9.pdf
================================================================================

3-1.処理詳細説明(全体)

システム名 f013カタログ部品データ作成
業務機能名 累積作成ツール

プログラムID f013-subgrp-parts-list-dom-record-gen プログラム名称 サブグループ別部品情報リストDOMファイルレコード生成

システムID
バージョン
プロジェクトNo

12170130-00

作成日
更新日

2025/1/8
2025/10/30
区分

作成者
更新者

3H.尚坤
3H.尚坤

専用

詳細内容

・解析プラグイン定義

振分モジュールでは、JSON形式の引数をもとに必要な情報を抽出し、部品一覧DOMファイルを読み込みます。

各プラグインは、以下の3段階処理（Before／Main／After）を通じてデータ解析を実施する。

前処理段階 (Before)
本処理段階 (Main)
後処理段階 (After)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。
部品一覧DOMファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。
処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

・API定義

Public void Before(string pluginParamJson,LogUtil logUtil)

パラメータ：

pluginParamJson

logUtil(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)

戻り値：
なし

プラグイン実行に必要な情報を格納したJSON文字列。
※詳細レイアウトは「プログラム基本設計書_プラグイン振分モジュール_解析加工IF定義」を参照。

LogUtilインスタンス
※ログ出力を行うための LogUtil インスタンス。

Public void Main(Action<DataRow> onDataRow)

パラメータ：

onDataRow

戻り値：
なし

レコードを逐次返却する用コールバック
※読み取ったレコードを一つずつ返却するコールバック

Public int After(out string jsonMessage)

パラメータ：

jsonMessgae

戻り値：

異常ありの場合、最後に発生したエラーのメッセージをJSON形式で返却する引数
DataLineageExecuteLogのdetail_message情報を更新するために使用される。

＞　正常終了の場合、 ExitCode=0
＞　異常発生の場合、最後に発生したエラーの ExitCode

・処理詳細

1. 前処理段階 (Before)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。

1.1 起動ログ情報の出力

プラグインの実行開始ログを出力する

メッセージ:

INFO タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」プラグインを開始します...

プロセスログ

PROCESS タイプ： 前処理(Beforeメソッド) 実行

1.2 入力引数の解析

引数 pluginParamJson のJSON形式文字列から、使用する情報を解析します。

プロセスログ

PROCESS タイプ： 引数（JSON）内容の解析

1.3 入力引数の内容チェック

1.3.1  「リソース管理」テーブルに、当リネージが使ってるリソースの設定情報チェック

必須項目の設定ありかをチェックして、

文字コード（code_page）が未設定の場合は、

エラーログを出力する（ExitCode：255）

メッセージ:

改訂No. 削

7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7

7
7

7
7
7
7

7
7
7

ERROR タイプ： 当リネージID「{lineageID}」の「リソース管理」テーブルにて、文字コード（code_page）の設定がされていません。

1.3.2  引数に指定のInputスキーマYamlに必須項目のチェック

指定された Input スキーマファイルに対して、柔軟に対応できるように、最小限の妥当性チェックだけを実施します。
LineageId をもとに転記仕様 YAML（transformYamlInfoDic）から該当のInputスキーマファイルを取得します。
必要な項目IDが含まれているかを確認します。

プロセスログ

PROCESS タイプ： 指定のInputスキーマファイル「{inputSchemaPath}」のチェック 実行

・チェック対象は、必須項目である「項目ID」(item_id) の存在確認に限定します。
＞　Inputスキーマファイルに、プラグインで定義された必須項目 ID が存在しない場合、

エラーログを出力する（ExitCode：253）

メッセージ:

ERROR タイプ： 当リネージID「{lineageID}」の「リソース管理テーブル」にて、指定されたInputスキーマYamlファイル:「{inputSchemaPath}」に、必須項目「{undefinedRequiredColumnList}」がないです。

必須項目一覧（本プラグインで定義される項目）。

項目№
1
2
3
4
5
6

項目ID
f013_car_model
f013_car_model_classification_code
f013_main_group_code
f013_sub_group_code
f013_fig_illust_disp_no
f013_subgrp_parts_list_dom_content

項目名
f013・車両モデル
f013・類別コード
f013・メイングループ
f013・サブグループコード
f013・イラスト表示順番
f013・サブグループ別部品情報リストDOMファイル情報

・それ以外の項目（例：項目名、項目順、型、項目長など）については、個別の検証は行いません。

1.4 入力ファイルチェック

プロセスログ

PROCESS タイプ： サブグループ別部品情報リストDOMファイル「{domFilePath}」のチェック 実行

1.4.1 入力ファイル命名規則に必須のマクロ変数が含まれているかのチェック
＞ 入力ファイル命名規則に必須マクロ変数が定義されていない場合：

エラーログを出力する（ExitCode：252）

ERROR タイプ： 当リネージID「{lineageId}」の「リソース管理」テーブルにて、指定された入力ファイル命名規則「{fileNameRule}」に必須マクロ変数「{macroName}」がないです。

1.4.2 入力ファイルの存在チェック

＞　入力ファイルが存在しない場合：

エラーログを出力する（ExitCode：245）

メッセージ：

ERROR タイプ： 対象データファイル「{filePath}」が見つかりません。

1.43 上記のチェック異常、処理対象のDOMファイルサイズは0バイトのチェック

＞ 入力データとしてDOMファイルのサイズを確認し、0 バイトの場合は破損ファイルと見なして処理を中断、

エラーログを出力する（ExitCode：243）

メッセージ：

ERROR タイプ： 対象データファイル「{filePath}」が0バイトで、累積処理を実行できません。

2. 本処理段階 (Main)

部品一覧DOMファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。

2.1 前処理段階 (Before)の結果判定:

ExitCode 情報に基づき、前処理段階 (Before)の実行結果を判断します。

> 前処理段階（Before）で Error が発生した場合

本処理段階(Main) の実行を スキップ します。
プロセスは直接後処理段階（After）に移行し、該当する例外結果を返却します。

> 前処理段階（Before）で Error が発生しなかった場合

後続処理を 続行 します。

2.1 DOMファイルの読み取りおよびInputスキーマ構造データの構築

プロセスログ

7

7
7
7
7

7
7
7
7

7
7
7
7
7
7
7
7
7
7

7
7
7
7
7
7

PROCESS タイプ： 本処理(Mainメソッド) 実行

2.1.1 DOMファイルの中身を読み取って、

「リソース管理」テーブルにて、指定文字コード（code_page）に基づいて DOM ファイルの中身を読み取ります。

※BOM 自動処理についてUTF 系文字コードの BOM（Byte Order Mark）は、使用する StreamReader によって自動的に処理されます。
そのため、正しく文字コード（code_page）を指定すれば、BOM の有無にかかわらず正常にテキストを解析できます。

2.1.2 指定列の値設定

DOMファイルのファイル名から、指定のマクロ変数で車の情報を取って、指定スキーマレイアウトにセットします。

・下記項目の値を固定値に設定します

1
2
3
4
5
6

f013_car_model
f013_car_model_classification_code
f013_main_group_code
f013_sub_group_code
f013_fig_illust_disp_no
f013_subgrp_parts_list_dom_content

←
←
←
←
←
←

DOMファイル名から車両モデル「!FS_CAR_MODEL!」
DOMファイル名から類別コード「!FS_CAR_MODEL_CLSSFN!」
DOMファイル名からイングループコード「!FS_MAINGRP_CD!」
DOMファイル名からサブグループコード「!FS_SUBGRP_CD!」
DOMファイル名からイラスト表示順番「!ILLUST_DISP_NO!」
DOMファイルの中身

※Inputスキーマレイアウトが上記定義内容と異なる場合の対応：
  ・項目長の変更

元データの長さチェックをしなくて、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・項目データ型の変更

元データの型チェックをしなくて（object 型として扱うため）、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・新規項目の場合、

上記にない項目については、このプラグインで値をセットしない場合、Inputスキーマで定義されたタイプに応じた初期値が設定されます。
別の初期値が必要な場合は、このプラグインのソースコードを変更する必要があります。

27

f013_xxxx_aaa

←

項目のタイプに応じた初期値を設定
※詳細は、ルールブックのシート「4)データの転記」内の「4　スキーマYAML定義におけるデータ型別初期値」を参照。

2.1.3 エラーデータの処理

レコードのエラーは、エラーハンドリング設定に従って対応されます。

エラーハンドリングモード一覧
エラーハンドリング

resume

skip

terminate

2.2 解析結果の返却

処理方法
エラーレコードをスキップし、次のレコードから処理を続行します。（ExitCode：124）
エラーメッセージを出力し
現在ファイルをスキップします。（ExitCode：124）
エラーメッセージを出力し
エラーメッセージを出力し、全処理を終了します。（ExitCode：255）

LineageIDに対応する入力スキーマレイアウトに従い、DataRow形式の解析結果データをコールバック方式（onDataRow）で呼び出し元に逐次返却します。

プロセスログ

正常件数：{normalCount}
異常件数：{errorCount}

3. 後処理段階 (After)

処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

プロセスログ

PROCESS タイプ： 後処理(Afterメソッド) 実行

3.1 処理完了時に、実行結果ログを出力する。

メッセージ:

> 正常完了

INFO タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」が正常完了しました。

> 異常終了

ERROR タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」が異常終了しました。

3.2 ExitCodeおよびメッセージ情報の返却

＞　正常終了の場合、ExitCode=0 でリターン、jsonMessageは空です。

7
7
7

7
7
7
7
7
7
7
7

7

＞　異常発生の場合、最後のエラーに対する ExitCode とエラー情報を返却する

7





================================================================================
ドキュメント: プログラム基本設計書_B145_累積作成_サブグループ別部品情報リストDOMファイルレコード生成_処理詳細_V8.pdf (PDF 2)
ファイル名: プログラム基本設計書_B145_累積作成_サブグループ別部品情報リストDOMファイルレコード生成_処理詳細_V8.pdf
================================================================================

3-1.処理詳細説明(全体)

システム名 f013カタログ部品データ作成
業務機能名 累積作成ツール

プログラムID f013-subgrp-parts-list-dom-record-gen プログラム名称 サブグループ別部品情報リストDOMファイルレコード生成

システムID
バージョン
プロジェクトNo

作成日
更新日

12170130-00

2025/1/8
2025/10/19
区分

作成者
更新者

3H.尚坤
3H.尚坤

専用

詳細内容

・解析プラグイン定義

振分モジュールでは、JSON形式の引数をもとに必要な情報を抽出し、部品一覧DOMファイルを読み込みます。

各プラグインは、以下の3段階処理（Before／Main／After）を通じてデータ解析を実施する。

前処理段階 (Before)
本処理段階 (Main)
後処理段階 (After)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。
部品一覧DOMファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。
処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

・API定義

Public Before(string pluginParamJson)

パラメータ：

pluginParamJson

戻り値：

プラグイン実行に必要な情報を格納したJSON文字列。
※詳細レイアウトは「プログラム基本設計書_プラグイン振分モジュール_解析加工IF定義」を参照。

チェック結果

ExitCode およびメッセージ情報（msgId, msg）を返却。

Public Main(Action<DataRow> onDataRow)

レコードを逐次返却する用コールバック
※読み取ったレコードを一つずつ返却するコールバック

パラメータ：

onDataRow

戻り値：
なし

Public After()
戻り値：

＞　正常終了の場合、 ExitCode=0 を返却する
＞　異常発生の場合、最後のエラーに対する ExitCode とエラー情報を返却する

・処理詳細

1. 前処理段階 (Before)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。

1.1 起動ログ情報の出力

プラグインの実行開始ログを出力する

出力内容
msgId
CI0001_AppStarted

メッセージテンプレート
「{0}」を開始します...

説明
0: 「サブグループ別部品情報リストDOMファイルレコード生成

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null) を参照する。

1.2 パラメータの解析

パラメータ pluginParamJson のJSON形式文字列から、使用する情報を解析します。

1.3 リネージ設定情報チェック

1.3.1  「リソース管理」テーブルに、当リネージが使ってるリソースの設定情報チェック

必須項目の設定ありかをチェックして、

文字コード（code_page）が未設定の場合は、

エラーログを出力する（ExitCode：255）

出力内容
msgId

メッセージテンプレート

CE0020_MissingRequir
edItemInSchema

当リネージID「{0}」の「リソース管理テーブル」にて、指定されたInputスキーマYamlファイ
ル:「{1}」に、必須項目「{2}」がないです。

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

1.3.2  引数に指定のInputスキーマYamlに必須項目のチェック

指定された Input スキーマファイルに対して、柔軟に対応できるように、最小限の妥当性チェックだけを実施します。
LineageId をもとに転記仕様 YAML（transformYamlInfoDic）から該当のInputスキーマファイルを取得します。
必要な項目IDが含まれているかを確認します。

説明
0：現在処理のリネージID
1：スキーマファイルの名称
2：文字コード（code_page）

改訂No. 削

7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7

7
7

7
7
7
7
7
7
7

7
7
7
7

7
7
7

7

7
7

・チェック対象は、必須項目である「項目ID」(item_id) の存在確認に限定します。
＞　Inputスキーマファイルに、プラグインで定義された必須項目 ID が存在しない場合、

エラーログを出力する（ExitCode：253）

出力内容
msgId

メッセージテンプレート

CE0020_MissingRequir
edItemInSchema

当リネージID「{0}」の「リソース管理テーブル」にて、指定されたInputスキーマYamlファイ
ル:「{1}」に、必須項目「{2}」がないです。

説明
0：現在処理のリネージID
1：スキーマファイルの名称
2：項目ID

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

必須項目一覧（本プラグインで定義される項目）。

項目№ 項目ID
1
2
3
4
5
6

f013_car_model
f013_car_model_classification_code
f013_main_group_code
f013_sub_group_code
f013_fig_illust_disp_no
f013_subgrp_parts_list_dom_content

項目名
f013・車両モデル
f013・類別コード
f013・メイングループ
f013・サブグループコード
f013・イラスト表示順番
f013・サブグループ別部品情報リストDOMファイル情報

・それ以外の項目（例：項目名、項目順、型、項目長など）については、個別の検証は行いません。

1.4 入力ファイルチェック

1.4.1  入力ファイル名が命名規則に従っているかのチェック
＞　入力ファイル名が命名規則に従っていない場合：

エラーログを出力する（ExitCode：244）

出力内容
msgId

CE0021_DataFileNamin
gRuleMismatch

メッセージテンプレート

説明

対象データファイル「{0}」は、当リネージの命名規則「{1}」に適合しません。

0：入力ファイルフルパス
1：リソース管理テーブル定義の名称ルール(repository+filenamerule)

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

1.4.2  入力ファイル命名規則に必須のマクロ変数が含まれているかのチェック
＞　入力ファイル命名規則に必須マクロ変数が定義されていない場合：

エラーログを出力する（ExitCode：253）

出力内容
msgId

メッセージテンプレート

CE0023_MissingRequir
edMacroVariable

当リネージID「{0}」の「リソース管理」テーブルにて、指定された入力ファイル命名規則「{1}
」に必須マクロ変数「{2}」がないです。

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

説明

0：現在処理のリネージID
1：入力ファイルの名称ルール
2：必須マクロ変数の名称

1.4.3 入力ファイルの存在チェック

＞　入力ファイルが存在しない場合：

エラーログを出力する（ExitCode：245）

出力内容
msgId

CE0022_DataFileNotFo
und

メッセージテンプレート

説明

対象データファイル「{0}」が見つかりません。

0：入力ファイルのフルパス

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

1.4.4 上記のチェック異常、処理対象のDOMファイルサイズは0バイトのチェック

＞ 入力データとしてDOMファイルのサイズを確認し、0 バイトの場合は破損ファイルと見なして処理を中断、

エラーログを出力する（ExitCode：243）

出力内容
msgId
CE0024_DataFileZeroB
ytes

メッセージテンプレート

説明

対象データファイル「{0}」が0バイトで、累積処理を実行できません。

0：入力ファイルのフルパス

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

7
7
7

7

7
7

7
7
7

7

7
7

7
7
7

7

7
7

7
7
7

7

7
7

7
7
7

7

7
7

2. 本処理段階 (Main)

部品一覧DOMファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。

2.1 DOMファイルの読み取りおよびInputスキーマ構造データの構築

2.1.1 DOMファイルの中身を読み取って、

「リソース管理」テーブルにて、指定文字コード（code_page）に基づいて DOM ファイルの中身を読み取ります。

※BOM 自動処理についてUTF 系文字コードの BOM（Byte Order Mark）は、使用する StreamReader によって自動的に処理されます。
そのため、正しく文字コード（code_page）を指定すれば、BOM の有無にかかわらず正常にテキストを解析できます。

2.1.2 指定列の値設定

DOMファイルのファイル名から、指定のマクロ変数で車の情報を取って、指定スキーマレイアウトにセットします。

・下記項目の値を固定値に設定します
f013_car_model
f013_car_model_classification_code
f013_main_group_code
f013_sub_group_code
f013_fig_illust_disp_no
f013_subgrp_parts_list_dom_content

1
2
3
4
5
6

←
←
←
←
←
←

DOMファイル名から車両モデル「!FS_CAR_MODEL!」
DOMファイル名から類別コード「!FS_CAR_MODEL_CLSSFN!」
DOMファイル名からイングループコード「!FS_MAINGRP_CD!」
DOMファイル名からサブグループコード「!FS_SUBGRP_CD!」
DOMファイル名からイラスト表示順番「!ILLUST_DISP_NO!」
DOMファイルの中身

※Inputスキーマレイアウトが上記定義内容と異なる場合の対応：
  ・項目長の変更

元データの長さチェックをしなくて、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・項目データ型の変更

元データの型チェックをしなくて（object 型として扱うため）、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・新規項目の場合、

上記にない項目については、このプラグインで値をセットしない場合、Inputスキーマで定義されたタイプに応じた初期値が設定されます。
別の初期値が必要な場合は、このプラグインのソースコードを変更する必要があります。

27

f013_xxxx_aaa

←

項目のタイプに応じた初期値を設定
※詳細は、ルールブックのシート「4)データの転記」内の「4　スキーマYAML定義におけるデータ型別初期値」を参照。

2.1.3 エラーデータの処理

レコードのエラーは、エラーハンドリング設定に従って対応されます。

エラーハンドリングモード一覧
エラーハンドリング

resume

skip

terminate

2.2 解析結果の返却

処理方法
エラーレコードをスキップし、次のレコードから処理を続行します。（ExitCode：124）
エラーメッセージを出力し
現在ファイルをスキップします。（ExitCode：124）
エラーメッセージを出力し
エラーメッセージを出力し、全処理を終了します。（ExitCode：255）

LineageIDに対応する入力スキーマレイアウトに従い、DataRow形式の解析結果データをコールバック方式（onDataRow）で呼び出し元に逐次返却します。

3. 後処理段階 (After)

処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

3.1 処理完了時に、実行結果ログを出力する。

出力内容
区分

msgId

メッセージテンプレート

正常完了

CI0006_AppSucces
s

「{0}」が正常完了しました。

異常終了 CI0007_AppFailure 「{0}」が異常終了しました。エラー内容: {1}

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null) を参照する。

3.2 ExitCodeおよびメッセージ情報の返却

＞　正常終了の場合、 ExitCode=0 を返却する
＞　異常発生の場合、最後のエラーに対する ExitCode とエラー情報を返却する

説明

0: サブグループ別部品情報リストPDFファイルレコード生成

0: サブグループ別部品情報リストPDFファイルレコード生成
1: 例外メッセージ（Exception.Message）

7
7

7
7
7
7
7
7
7

7

7

7
7

7
7


