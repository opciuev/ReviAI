
================================================================================
ドキュメント: プログラム基本設計書_B145_累積作成_サブグループ別情報リス部品トDOMファイルレコード生成_AI審査.pdf (PDF 1)
ファイル名: プログラム基本設計書_B145_累積作成_サブグループ別情報リス部品トDOMファイルレコード生成_AI審査.pdf
================================================================================

要求No 要求内容 (ペルソナ: 指令)

評価 (〇/△/×) 適合/不適合箇所

適合/不適合理由

修正案 (ゴールデンケースを含む)

対応有無 対応方法／非対応理由

SA-1

SystemArchitect: 技術選定の
妥当性評価

〇

V9 PDF, p.1, 「・API定義」

SA-2

SystemArchitect: 機能要件と非
機能要件の分離と結合

△

SA-3

SystemArchitect: 論理トレーサ
ビリティの検証

△

文書全体

文書全体

V8からV9へのAPIシグネチャ変更は、設計品質を向上させている。LogUtilインスタンスをDI
（依存性注入）する設計に変更したことで、ロギング機能が分離され、単体テストが容易になっ
た。
また、Afterメソッドで戻り値とout引数を使って結果を返すのは、C#における標準的な実践で
あり、コードの可読性と保守性が向上している。
本文書は機能要件（何をすべきか）に焦点を当てているが、非機能要件（どのくらいの性能、
安全性で実行すべきか）に関する記述が欠落している。
例えば、処理対象のDOMファイルの最大サイズ、期待される処理時間、メモリ使用量の上限、
入力パス検証などのセキュリティ要件が定義されていない。
この基本設計書が、どの要件定義書のどの要求項目（例：REQ-ID-123）を実現するためのも
のなのか、上位要件への参照が記載されていない。
これにより、要件から設計、実装、テストへの一貫した追跡（トレーサビリティ）が困難になって
いる。

QA-1

QAManager: 処理ロジックの具
体性評価 (WDT分析)

×

V9 PDF, p.3, 「2.1.2 指定列の値設定」

「DOMファイルのファイル名から、指定のマクロ変数で車の情報を取って」という記述は、処理
（Do）の具体性が著しく欠けている。ファイル名からどのようにしてマクロ変数の値を抽出する
のか（例：正規表現、区切り文字による分割など）が不明なため、テスト担当者は異常なファイ
ル名パターン（例：区切り文字が複数、順序が違う等）のテストケースを作成できない。

修正は不要。この設計改善は評価できる。

×

非機能要件の章を新設し、性能（例：10MBのDOMファイルを30秒以内に処理）、
可用性、セキュリティ（例：ファイルパスの無害化）に関する具体的な目標値を明
記する。

×

文書の冒頭に「関連要件」の項を設け、この設計が準拠する要件定義書の要求
IDを一覧で明記する。

×

　ご指摘の非機能要件（性能、メモリ上限等）は、本プラグ
インを呼び出す上位（Host）側の責務である。プラグイン
側で重複して定義することは、管理の複雑化を招くため行
わない。

　関連要件 は共通仕様書にて一元管理されている。個別
のプラグイン設計書で重複して定義することは、管理の複
雑化を招くため行わない。

【ゴールデンケース】
マクロ変数の抽出ロジックを具体的に記述する。
例：
1. ファイル名に対して、「リソース管理」で定義された命名規則（正規表現パター
ン）でマッチングを行う。
2. パターン内の名前付きキャプチャグループ（例：`(?<FS_CAR_MODEL>.*?)`）を
使い、各マクロ変数に対応する値を抽出する。
3. マッチングに失敗した場合は、エラーとして処理を中断し、ExitCode XXXを返
却する。

　AI審査員は本プラグインの設計を根本的に誤解してい
る。本プラグインのルールは動的（Dynamic）であり、審査
員が提案するような静的（Static）なルール ではない。

×

QA-2

QAManager: 異常系の網羅性 △

V9 PDF, p.3, 「2.1.3 エラーデータの処理」

Main処理における「レコードのエラー」が何を指すのか定義されていない。DOMファイルの構
文エラーなのか、データ型の不一致なのか、業務ルール上の矛盾なのかが不明確。このた
め、エラーハンドリングモード（resume, skip, terminate）が正しく機能するかを検証するための
テスト設計が不可能である。

「レコードのエラー」として想定されるケースを具体的に定義する。
例：
- DOMファイルのXML/JSON構造が不正で解析できない場合。
- 必須項目に対応するデータが存在しない場合。
- [特定の業務ルール]に違反する場合。
各エラーケースに対して、どのハンドリングモードでどう振る舞うかを明記する。 ×

QA-3

QAManager: 用語と定義の明確
化

△

V8とV9のログ出力仕様の比較 (例: V8 p.2
1.3.1 vs V9 p.2 1.3.1)

旧版(V8)ではメッセージID（例: CE0020）を用いた構造化ロギングが採用されていたが、新版
(V9)ではハードコードされた文字列によるログ出力に戻っている。
これは品質のデグレード（後退）であり、ログの集中管理、多言語対応、自動監視ツールとの
連携を困難にするため、保守性を低下させる。

V8で採用されていたメッセージIDベースの構造化ロギング方式に差し戻す。す
べてのログ出力を中央のLogUtil経由で行い、メッセージはIDとパラメータで管理
するように修正する。

×

　本プラグインの責務は、DOMファイル（XML/JSON）の構
造解析に限定される。「レコードのエラー」とは、この構造
解析（パース）に失敗した場合を指す。ご指摘にあるよう
な「業務ルール」のチェックは本プラグインの責務外（上位
の責務）であるため、これ以上の詳細化は行わない。

　V8のID方式 からV9のテキスト形式 への変更は、ログ
の柔軟性向上を目的としたシステム全体の意図的なアー
キテクチャ変更であるため、V8の仕様（メッセージID） に
差し戻すことは行わない。





================================================================================
ドキュメント: プログラム基本設計書_B145_累積作成_サブグループ別部品情報リストDOMファイルレコード生成_処理詳細_V10.pdf (PDF 2)
ファイル名: プログラム基本設計書_B145_累積作成_サブグループ別部品情報リストDOMファイルレコード生成_処理詳細_V10.pdf
================================================================================

3-1.処理詳細説明(全体)

システム名 f013カタログ部品データ作成
業務機能名 累積作成ツール

プログラムID f013-subgrp-parts-list-dom-record-gen プログラム名称 サブグループ別部品情報リストDOMファイルレコード生成

システムID
バージョン
プロジェクトNo

12170130-00

作成日
更新日

2025/1/8
2025/10/30
区分

作成者
更新者

3H.尚坤
3H.尚坤

専用

詳細内容

・解析プラグイン定義

振分モジュールでは、JSON形式の引数をもとに必要な情報を抽出し、部品一覧DOMファイルを読み込みます。

各プラグインは、以下の3段階処理（Before／Main／After）を通じてデータ解析を実施する。

前処理段階 (Before)
本処理段階 (Main)
後処理段階 (After)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。
部品一覧DOMファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。
処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

・API定義

Public void Before(string pluginParamJson,LogUtil logUtil)

パラメータ：

pluginParamJson

logUtil(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)

戻り値：
なし

プラグイン実行に必要な情報を格納したJSON文字列。
※詳細レイアウトは「プログラム基本設計書_プラグイン振分モジュール_解析加工IF定義」を参照。

LogUtilインスタンス
※ログ出力を行うための LogUtil インスタンス。

Public void Main(Action<DataRow> onDataRow)

パラメータ：

onDataRow

戻り値：
なし

レコードを逐次返却する用コールバック
※読み取ったレコードを一つずつ返却するコールバック

Public int After(out string jsonMessage)

パラメータ：

jsonMessgae

戻り値：

異常ありの場合、最後に発生したエラーのメッセージをJSON形式で返却する引数
DataLineageExecuteLogのdetail_message情報を更新するために使用される。

＞　正常完了の場合、 ExitCode=0
＞　異常発生の場合、最後に発生したエラーの ExitCode

・処理詳細

1. 前処理段階 (Before)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。

1.1 起動ログ情報の出力

プラグインの実行開始ログを出力する

メッセージ:

INFORMATION タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」プラグインを開始します...

プロセスログ

PROCESS タイプ： 前処理(Beforeメソッド) 実行

1.2 入力引数の解析

引数 pluginParamJson のJSON形式文字列から、使用する情報を解析します。

プロセスログ

PROCESS タイプ： 引数（JSON）内容の解析

1.3 入力引数の内容チェック

1.3.1  「リソース管理」テーブルに、当リネージが使ってるリソースの設定情報チェック

必須項目の設定ありかをチェックして、

文字コード（code_page）が未設定の場合は、

エラーログを出力する（ExitCode：255）

改訂No. 削

7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7

7
7

7
7
7
7

7
7

メッセージ:

ERROR タイプ： 当リネージID「{lineageID}」の「リソース管理」テーブルにて、文字コード（code_page）の設定がされていません。

1.3.2  引数に指定のInputスキーマYamlに必須項目のチェック

指定された Input スキーマファイルに対して、柔軟に対応できるように、最小限の妥当性チェックだけを実施します。
LineageId をもとに転記仕様 YAML（transformYamlInfoDic）から該当のInputスキーマファイルを取得します。
必要な項目IDが含まれているかを確認します。

プロセスログ

PROCESS タイプ： 指定のInputスキーマファイル「{inputSchemaPath}」のチェック 実行

・チェック対象は、必須項目である「項目ID」(item_id) の存在確認に限定します。
＞　Inputスキーマファイルに、プラグインで定義された必須項目 ID が存在しない場合、

エラーログを出力する（ExitCode：253）

メッセージ:

ERROR タイプ： 当リネージID「{lineageID}」の「リソース管理テーブル」にて、指定されたInputスキーマYamlファイル:「{inputSchemaPath}」に、必須項目「{undefinedRequiredColumnList}」がないです。

必須項目一覧（本プラグインで定義される項目）。

項目№
1
2
3
4
5
6

項目ID
f013_car_model
f013_car_model_classification_code
f013_main_group_code
f013_sub_group_code
f013_fig_illust_disp_no
f013_subgrp_parts_list_dom_content

項目名
f013・車両モデル
f013・類別コード
f013・メイングループ
f013・サブグループコード
f013・イラスト表示順番
f013・サブグループ別部品情報リストDOMファイル情報

・それ以外の項目（例：項目名、項目順、型、項目長など）については、個別の検証は行いません。

1.4 入力ファイルチェック

プロセスログ

PROCESS タイプ： サブグループ別部品情報リストDOMファイル「{domFilePath}」のファイルチェック 実行

1.4.1 入力ファイル命名規則に必須のマクロ変数が含まれているかのチェック
＞ 入力ファイル命名規則に必須マクロ変数が定義されていない場合：

エラーログを出力する（ExitCode：252）

ERROR タイプ： 当リネージID「{lineageId}」の「リソース管理」テーブルにて、指定された入力ファイル命名規則「{fileNameRule}」に必須マクロ変数「{macroName}」がないです。

1.4.2 入力ファイルの存在チェック

＞　入力ファイルが存在しない場合：

エラーログを出力する（ExitCode：245）

メッセージ：

ERROR タイプ： 対象データファイル「{domFilePath}」が見つかりません。

1.4.3 上記のチェック異常、処理対象のDOMファイルサイズは0バイトのチェック

＞ 入力データとしてDOMファイルのサイズを確認し、0 バイトの場合は破損ファイルと見なして処理を中断、

エラーログを出力する（ExitCode：243）

メッセージ：

ERROR タイプ： 対象データファイル「{domFilePath}」が0バイトで、累積処理を実行できません。

1.5 Before段階の例外処理

前処理段階(Before)にて、予期しない例外が発生した場合の処理を以下に示します。

例外発生時、以下の3条のエラーログを出力します：

ERROR タイプ： Before段階でエラーが発生しました。ファイル: {excelFilePath}
ERROR タイプ： {ex.Message}
ERROR タイプ： {ex.StackTrace}

2. 本処理段階 (Main)

部品一覧DOMファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。

2.1 前処理段階 (Before)の結果判定:

ExitCode 情報に基づき、前処理段階 (Before)の実行結果を判断します。

7
7

7
7
7
7

7
7
7
7

7
7
7
7

7
7
7
7
7
7

7
7
7

7

7
7

> 前処理段階（Before）で Error が発生した場合

本処理段階(Main) の実行を スキップ します。
プロセスは直接後処理段階（After）に移行し、該当する例外結果を返却します。

PROCESS タイプ： Before処理でエラーが発生したため、Main処理をスキップします。ExitCode: {exitCode}

> 前処理段階（Before）で Error が発生しなかった場合

後続処理を 続行 します。

2.1 DOMファイルの読み取りおよびInputスキーマ構造データの構築

DOMファイルの読み取り、内容をリードし、以下の処理で指定されたInputスキーマレイアウトに変換し、コールバック方式でexe側に戻します。

プロセスログ

PROCESS タイプ： 本処理(Mainメソッド) 実行

入力ファイル情報を出力します。

INFORMATION タイプ： 入力ファイル: {domFilePath}

2.1.1 DOMファイルの中身を読み取って、

「リソース管理」テーブルにて、指定文字コード（code_page）に基づいて DOM ファイルの中身を読み取ります。

※BOM 自動処理についてUTF 系文字コードの BOM（Byte Order Mark）は、使用する StreamReader によって自動的に処理されます。
そのため、正しく文字コード（code_page）を指定すれば、BOM の有無にかかわらず正常にテキストを解析できます。

2.1.2 指定列の値設定

DOMファイルのファイル名から、指定のマクロ変数で車の情報を取って、指定スキーマレイアウトにセットします。

・下記項目の値を固定値に設定します

1
2
3
4
5
6

f013_car_model
f013_car_model_classification_code
f013_main_group_code
f013_sub_group_code
f013_fig_illust_disp_no
f013_subgrp_parts_list_dom_content

←
←
←
←
←
←

DOMファイル名から車両モデル「!FS_CAR_MODEL!」
DOMファイル名から類別コード「!FS_CAR_MODEL_CLSSFN!」
DOMファイル名からイングループコード「!FS_MAINGRP_CD!」
DOMファイル名からサブグループコード「!FS_SUBGRP_CD!」
DOMファイル名からイラスト表示順番「!ILLUST_DISP_NO!」
DOMファイルの中身

※Inputスキーマレイアウトが上記定義内容と異なる場合の対応：
  ・項目長の変更

元データの長さチェックをしなくて、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・項目データ型の変更

元データの型チェックをしなくて（object 型として扱うため）、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・新規項目の場合、

上記にない項目については、このプラグインで値をセットしない場合、Inputスキーマで定義されたタイプに応じた初期値が設定されます。
別の初期値が必要な場合は、このプラグインのソースコードを変更する必要があります。

27

f013_xxxx_aaa

2.2.3 エラーデータの処理

←

項目のタイプに応じた初期値を設定
※詳細は、ルールブックのシート「4)データの転記」内の「4　スキーマYAML定義におけるデータ型別初期値」を参照。

行(レコード)単位で、異常が発生すると、最後の異常内容をキャシューして、ブラグインの実行結果として処理する。(Afterメソッドで戻します)

レコードのエラーは、エラーハンドリング設定に従って対応されます。

まず、異常行のログ出力し、プラグインの実行結果メッセージ、ExitCodeも更新しておいて

ExitCodeも、エラーハンドリングによってセットする。

エラーハンドリングモード一覧
エラーハンドリング

resume

skip

terminate

処理方法
エラーレコードをスキップし、次のレコードから処理を続行します。（ExitCode：124）
エラーメッセージを出力し
現在ファイルをスキップします。（ExitCode：124）
エラーメッセージを出力し
エラーメッセージを出力し、全処理を終了します。（ExitCode：255）

2.2 解析結果の返却

LineageIDに対応する入力スキーマレイアウトに従い、DataRow形式の解析結果データをコールバック方式（onDataRow）で呼び出し元に逐次返却します。

2.3 Main段階の例外処理

処理段階(Main)にて、予期しない例外が発生した場合の処理を以下に示します。
ERROR タイプ： Main段階でエラーが発生しました。ファイル: {excelFilePath}
ERROR タイプ： {ex.Message}
ERROR タイプ： {ex.StackTrace}

例外発生の有無に関わらず、以下の処理を実行します

件数統計ログの出力

INFORMATION タイプ： 正常件数：{normalCount}
INFORMATION タイプ： 異常件数：{errorCount}

3. 後処理段階 (After)

処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

プロセスログ

PROCESS タイプ： 後処理(Afterメソッド) 実行

3.1 処理完了時に、実行結果ログを出力する。

メッセージ:

> 正常完了

INFORMATION タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」が正常完了しました。

> 異常終了

ERROR タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」が異常終了しました。

3.2 ExitCodeおよびメッセージ情報の返却

＞　正常完了の場合、ExitCode=0 でリターン、jsonMessageは空です。
＞　異常発生の場合、最後のエラーに対する ExitCode とエラー情報を返却する

7
7
7

7
7
7
7
7
7
7
7

7
7





================================================================================
ドキュメント: プログラム基本設計書_B145_累積作成_サブグループ別部品情報リストDOMファイルレコード生成_処理詳細_V9.pdf (PDF 3)
ファイル名: プログラム基本設計書_B145_累積作成_サブグループ別部品情報リストDOMファイルレコード生成_処理詳細_V9.pdf
================================================================================

3-1.処理詳細説明(全体)

システム名 f013カタログ部品データ作成
業務機能名 累積作成ツール

プログラムID f013-subgrp-parts-list-dom-record-gen プログラム名称 サブグループ別部品情報リストDOMファイルレコード生成

システムID
バージョン
プロジェクトNo

12170130-00

作成日
更新日

2025/1/8
2025/10/30
区分

作成者
更新者

3H.尚坤
3H.尚坤

専用

詳細内容

・解析プラグイン定義

振分モジュールでは、JSON形式の引数をもとに必要な情報を抽出し、部品一覧DOMファイルを読み込みます。

各プラグインは、以下の3段階処理（Before／Main／After）を通じてデータ解析を実施する。

前処理段階 (Before)
本処理段階 (Main)
後処理段階 (After)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。
部品一覧DOMファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。
処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

・API定義

Public void Before(string pluginParamJson,LogUtil logUtil)

パラメータ：

pluginParamJson

logUtil(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)

戻り値：
なし

プラグイン実行に必要な情報を格納したJSON文字列。
※詳細レイアウトは「プログラム基本設計書_プラグイン振分モジュール_解析加工IF定義」を参照。

LogUtilインスタンス
※ログ出力を行うための LogUtil インスタンス。

Public void Main(Action<DataRow> onDataRow)

パラメータ：

onDataRow

戻り値：
なし

レコードを逐次返却する用コールバック
※読み取ったレコードを一つずつ返却するコールバック

Public int After(out string jsonMessage)

パラメータ：

jsonMessgae

戻り値：

異常ありの場合、最後に発生したエラーのメッセージをJSON形式で返却する引数
DataLineageExecuteLogのdetail_message情報を更新するために使用される。

＞　正常終了の場合、 ExitCode=0
＞　異常発生の場合、最後に発生したエラーの ExitCode

・処理詳細

1. 前処理段階 (Before)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。

1.1 起動ログ情報の出力

プラグインの実行開始ログを出力する

メッセージ:

INFO タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」プラグインを開始します...

プロセスログ

PROCESS タイプ： 前処理(Beforeメソッド) 実行

1.2 入力引数の解析

引数 pluginParamJson のJSON形式文字列から、使用する情報を解析します。

プロセスログ

PROCESS タイプ： 引数（JSON）内容の解析

1.3 入力引数の内容チェック

1.3.1  「リソース管理」テーブルに、当リネージが使ってるリソースの設定情報チェック

必須項目の設定ありかをチェックして、

文字コード（code_page）が未設定の場合は、

エラーログを出力する（ExitCode：255）

メッセージ:

改訂No. 削

7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7
7

7
7

7
7
7
7

7
7
7

ERROR タイプ： 当リネージID「{lineageID}」の「リソース管理」テーブルにて、文字コード（code_page）の設定がされていません。

1.3.2  引数に指定のInputスキーマYamlに必須項目のチェック

指定された Input スキーマファイルに対して、柔軟に対応できるように、最小限の妥当性チェックだけを実施します。
LineageId をもとに転記仕様 YAML（transformYamlInfoDic）から該当のInputスキーマファイルを取得します。
必要な項目IDが含まれているかを確認します。

プロセスログ

PROCESS タイプ： 指定のInputスキーマファイル「{inputSchemaPath}」のチェック 実行

・チェック対象は、必須項目である「項目ID」(item_id) の存在確認に限定します。
＞　Inputスキーマファイルに、プラグインで定義された必須項目 ID が存在しない場合、

エラーログを出力する（ExitCode：253）

メッセージ:

ERROR タイプ： 当リネージID「{lineageID}」の「リソース管理テーブル」にて、指定されたInputスキーマYamlファイル:「{inputSchemaPath}」に、必須項目「{undefinedRequiredColumnList}」がないです。

必須項目一覧（本プラグインで定義される項目）。

項目№
1
2
3
4
5
6

項目ID
f013_car_model
f013_car_model_classification_code
f013_main_group_code
f013_sub_group_code
f013_fig_illust_disp_no
f013_subgrp_parts_list_dom_content

項目名
f013・車両モデル
f013・類別コード
f013・メイングループ
f013・サブグループコード
f013・イラスト表示順番
f013・サブグループ別部品情報リストDOMファイル情報

・それ以外の項目（例：項目名、項目順、型、項目長など）については、個別の検証は行いません。

1.4 入力ファイルチェック

プロセスログ

PROCESS タイプ： サブグループ別部品情報リストDOMファイル「{domFilePath}」のチェック 実行

1.4.1 入力ファイル命名規則に必須のマクロ変数が含まれているかのチェック
＞ 入力ファイル命名規則に必須マクロ変数が定義されていない場合：

エラーログを出力する（ExitCode：252）

ERROR タイプ： 当リネージID「{lineageId}」の「リソース管理」テーブルにて、指定された入力ファイル命名規則「{fileNameRule}」に必須マクロ変数「{macroName}」がないです。

1.4.2 入力ファイルの存在チェック

＞　入力ファイルが存在しない場合：

エラーログを出力する（ExitCode：245）

メッセージ：

ERROR タイプ： 対象データファイル「{filePath}」が見つかりません。

1.43 上記のチェック異常、処理対象のDOMファイルサイズは0バイトのチェック

＞ 入力データとしてDOMファイルのサイズを確認し、0 バイトの場合は破損ファイルと見なして処理を中断、

エラーログを出力する（ExitCode：243）

メッセージ：

ERROR タイプ： 対象データファイル「{filePath}」が0バイトで、累積処理を実行できません。

2. 本処理段階 (Main)

部品一覧DOMファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。

2.1 前処理段階 (Before)の結果判定:

ExitCode 情報に基づき、前処理段階 (Before)の実行結果を判断します。

> 前処理段階（Before）で Error が発生した場合

本処理段階(Main) の実行を スキップ します。
プロセスは直接後処理段階（After）に移行し、該当する例外結果を返却します。

> 前処理段階（Before）で Error が発生しなかった場合

後続処理を 続行 します。

2.1 DOMファイルの読み取りおよびInputスキーマ構造データの構築

プロセスログ

7

7
7
7
7

7
7
7
7

7
7
7
7
7
7
7
7
7
7

7
7
7
7
7
7

PROCESS タイプ： 本処理(Mainメソッド) 実行

2.1.1 DOMファイルの中身を読み取って、

「リソース管理」テーブルにて、指定文字コード（code_page）に基づいて DOM ファイルの中身を読み取ります。

※BOM 自動処理についてUTF 系文字コードの BOM（Byte Order Mark）は、使用する StreamReader によって自動的に処理されます。
そのため、正しく文字コード（code_page）を指定すれば、BOM の有無にかかわらず正常にテキストを解析できます。

2.1.2 指定列の値設定

DOMファイルのファイル名から、指定のマクロ変数で車の情報を取って、指定スキーマレイアウトにセットします。

・下記項目の値を固定値に設定します

1
2
3
4
5
6

f013_car_model
f013_car_model_classification_code
f013_main_group_code
f013_sub_group_code
f013_fig_illust_disp_no
f013_subgrp_parts_list_dom_content

←
←
←
←
←
←

DOMファイル名から車両モデル「!FS_CAR_MODEL!」
DOMファイル名から類別コード「!FS_CAR_MODEL_CLSSFN!」
DOMファイル名からイングループコード「!FS_MAINGRP_CD!」
DOMファイル名からサブグループコード「!FS_SUBGRP_CD!」
DOMファイル名からイラスト表示順番「!ILLUST_DISP_NO!」
DOMファイルの中身

※Inputスキーマレイアウトが上記定義内容と異なる場合の対応：
  ・項目長の変更

元データの長さチェックをしなくて、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・項目データ型の変更

元データの型チェックをしなくて（object 型として扱うため）、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・新規項目の場合、

上記にない項目については、このプラグインで値をセットしない場合、Inputスキーマで定義されたタイプに応じた初期値が設定されます。
別の初期値が必要な場合は、このプラグインのソースコードを変更する必要があります。

27

f013_xxxx_aaa

←

項目のタイプに応じた初期値を設定
※詳細は、ルールブックのシート「4)データの転記」内の「4　スキーマYAML定義におけるデータ型別初期値」を参照。

2.1.3 エラーデータの処理

レコードのエラーは、エラーハンドリング設定に従って対応されます。

エラーハンドリングモード一覧
エラーハンドリング

resume

skip

terminate

2.2 解析結果の返却

処理方法
エラーレコードをスキップし、次のレコードから処理を続行します。（ExitCode：124）
エラーメッセージを出力し
現在ファイルをスキップします。（ExitCode：124）
エラーメッセージを出力し
エラーメッセージを出力し、全処理を終了します。（ExitCode：255）

LineageIDに対応する入力スキーマレイアウトに従い、DataRow形式の解析結果データをコールバック方式（onDataRow）で呼び出し元に逐次返却します。

プロセスログ

正常件数：{normalCount}
異常件数：{errorCount}

3. 後処理段階 (After)

処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

プロセスログ

PROCESS タイプ： 後処理(Afterメソッド) 実行

3.1 処理完了時に、実行結果ログを出力する。

メッセージ:

> 正常完了

INFO タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」が正常完了しました。

> 異常終了

ERROR タイプ： 「サブグループ別部品情報リストDOMファイルレコード生成」が異常終了しました。

3.2 ExitCodeおよびメッセージ情報の返却

＞　正常終了の場合、ExitCode=0 でリターン、jsonMessageは空です。

7
7
7

7
7
7
7
7
7
7
7

7

＞　異常発生の場合、最後のエラーに対する ExitCode とエラー情報を返却する

7


