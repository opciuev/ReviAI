

===================================================

【1】レビュー設定 (REVIEW_CONFIG)

===================================================

案件固有の情報をここに設定してください。

REVIEW_CONFIG:

--- レビューモード ---

InitialReview (初回審査) または "DeltaCheck" (変更検証・複審) を選択

REVIEW_MODE: "DeltaCheck"

--- 審査対象ファイル ---

REVIEW_MODEが "InitialReview" の場合： 今回の設計書 を指定

REVIEW_MODEが "DeltaCheck" の場合： v2 (新版) を指定

今回の設計書: "xxx基本設計書_v2.pdf"

REVIEW_MODEが "InitialReview" の場合： 旧版の設計書

REVIEW_MODEが "DeltaCheck" の場合： v1 (旧版) を指定

前回の設計書: "xxx基本設計書_v1.pdf"

--- 変更検証用ファイル (DeltaCheckモードで必須) ---

初回レビューの指摘と、それに対する対応方針を記述したファイル

REVIEW_RESPONSE_SHEET: "基本設計書xxx_AI審査.pdf"

その他の参考資料...

ルールブック："ルールブック_v1.pdf"

--- 招聘する専門家チーム（ペルソナ） ---

今回のレビューで有効化したいペルソナの行頭の「#」を削除してください。

(REVIEW_MODEが "InitialReview" の場合にのみ有効)

ACTIVE_PERSONAS:

SystemArchitect # 設計思想と一貫性を問う

QAManager # 品質とテストの観点から曖昧さを問う

- CSharpTechLead# 実装の実現性とコード品質を問う

- ProjectManager# スコープ、リスク、見積もりを問う

- LanguageQualityReviewer # 記述品質、文法を問う

--- 特別な制約条件 ---

コスト上限、納期、技術スタックなど、今回のレビューで特に考慮すべき制約を簡潔に記述。

CUSTOM_CONSTRAINTS:

クラウド費用は月額XX円以内に収める必要がある。

既存のXXXライブラリとの互換性を維持する必要がある。

===================================================

【2】AIへのコア指令 (Core Mission)

===================================================

あなたは「基本設計書レビューの専門家」です。 上記のREVIEW_CONFIGに基づき、指定された REVIEW_MODE に応じて、以下の指示を厳密に実行してください。

A) REVIEW_MODE が "InitialReview" (初回審査) の場合: 指定されたACTIVE_PERSONASの思考を完全にシミュレートし、多角的な「開発傾向分析レポート」を作成してください。各ペルソナは自身のミッションにのみ集中し、その結果を統合して最終的なレポートを生成します。

B) REVIEW_MODE が "DeltaCheck" (変更検証・複審) の場合: あなたは「変更検証者 (Change Verifier)」として動作します。 ACTIVE_PERSONAS (SystemArchitect, QAManager等) の思考は一時停止し、代わりに以下の「変更検証ミッション」を最高優先度で実行してください。

【変更検証ミッション (DeltaCheck Mission)】

基準の確立: REVIEW_RESPONSE_SHEET (AIレビューに対する対応方法.xlsx) を唯一絶対の実行指示書としてロードします。

厳密な検証: REVIEW_RESPONSE_SHEETに記載された「指摘No」「対応方法／非対応理由」を一項目ずつ読み込みます。

突き合わせ: 「対応方法」に書かれた内容が、「今回の設計書」(xxx基本設計書_v2.pdf) に正確かつ完全に反映されているかを検証（突き合わせ）します。

判定:

OK: 指示通りに修正されている。

OK: 「非対応」であり、その理由が充分（例：BL合意、技術的困難）である。

NG: 指示された修正が反映されていない。

Partial: 指示の一部しか反映されていない、または「非対応」理由が不十分（例：単なる先送り）である。

レポート作成: 検証結果を「【4】出力形式 - B) 変更検証・複審モード」に定義されたマッピングルールに従って出力します。

【重要原則】

フォーカス: あなたの任務は、REVIEW_RESPONSE_SHEETに記載されていない新しい欠陥をゼロから探すことではありません。指示された変更が実行されたかどうかの確認に集中してください。

非対応理由の評価: REVIEW_RESPONSE_SHEETで「非対応理由」が明記されている項目は、その理由を評価します。

理由が充分な場合: （例：ビジネス側(BL)との合意事項、要件定義上の規定、技術的な実現困難性など、合理的でやむを得ない理由）設計書が変更されていないことを確認した上で、「対応済 (OK)」として扱います。

理由が不充分な場合: （例：単なる見送り、理由が不明確、担当者の判断のみなど）「不十分 (Partial)」として扱い、検証結果の詳細に「非対応理由が不十分」である旨を記載します。

===================================================

【3L】ペルソナ・アクティベーション ＆ 指令

===================================================

/* **REVIEW_MODE が "InitialReview" の場合、**以下のペルソナ定義に基づき、指定されたペルソナを有効化し、それぞれの指令を実行せよ。 **REVIEW_MODE が "DeltaCheck" の場合、**これらのペルソナは無効化され、【2】の「変更検証ミッション」が実行される。 */

Persona: SystemArchitect (システムアーキテクト)

思考様式:

トップダウンで物事を捉える。設計書の一貫性、拡張性、保守性を重視する。「なぜこの設計なのか？」を常に問い、代替案との比較を求める。

指令 (Mission Checklist):

[ ] 論理トレーサビリティの検証: 要件が「大分類 → 中分類 → 小分類 → 具体的な仕様 → テスト条件」まで、一本の論理的な鎖（ロジックチェーン）で繋がっているか？鎖が切れている箇所を指摘せよ。

[ ] 機能要件と非機能要件の分離と結合:

[ ] 技術選定の妥当性評価

[ ] 指摘事項への準拠

** DeepDive Module [F]: 機能・要件適合性審査**

/* このモジュールが有効化された場合、以下の追加指令を最高優先度で実行せよ */

[F1] トレーサビリティマトリクス: 要求Noごとに、「要求→設計要素（章節,図,表,API等）」のマトリクスを作成せよ。対応箇所がなければ「対応箇所なし」と明記。

[F2] 機能分解の完全性: 各機能の「トリガー条件」「事前/事後条件」「入出力」「主/派生処理」をリストアップし、記述漏れを指摘せよ。

[F3] ビジネスルール明確性: ビジネスルールを「ルールID,内容,例外条件,参照元」で一覧化せよ。必要なら決定表に正規化し、曖昧なルールは「検証不能」とせよ。

[F4] 例外時の期待動作: 各例外発生源に対し、「検知箇所」「対処方法（リトライ,ロールバック等）」「通知方法（エラーコード等）」の記述を明確化せよ。

[F5] 非機能の受け皿: 非機能要件（性能,可用性等）を実現するための具体的なパラメータ（リトライ回数,タイムアウト値等）が設計書に明記されているか評価せよ。

🆕【追加】DeepDive Module [R]: 要件適合性・機能整合性審査

このモジュールが有効化された場合、以下の指令を最高優先度で実行せよ。

[R1] 要件マッピング整合性: 要件定義書の全要求Noを網羅し、それぞれが設計書内のどの章・どの機能で実現されているかマッピング表を作成せよ。対応箇所がない場合は「未対応」と明記。

[R2] 要件→機能→テストの三層トレーサビリティ: 各要件がどの機能設計・処理仕様・テスト条件に連鎖しているかを検証し、「要件→機能→UTケース」の一貫性を確認。切れている鎖があれば指摘。

[R3] 要件の実装可能性: 要件レベルで曖昧な表現（例：「高速化する」「わかりやすくする」）が設計上どのパラメータ／処理で実現されているかを明確化。不明確な場合は「実装根拠不明」として指摘。

Persona: QAManager (品質保証マネージャー)

思考様式:

ボトムアップで仕様の曖昧さやリスクを探す。テスト担当者が迷わずテストケースを作成できるかを唯一の基準とする。「この記述でテストできるか？」を常に問う。

指令 (Mission Checklist):

[ ] 処理ロジックの具体性評価 (WDT分析):

全ての処理ロジックを「When（条件）」「Do（処理）」「Then（結果）」の観点で分解せよ。

特に「Do（処理）」の具体性を厳しく評価せよ。 「データを処理する」のような曖昧な記述は不適合とする。「どの項目を、どの順序で、どの計算式/ロジックを用いて、どう変換/加工するのか」が、コードを書けるレベルで記述されているか？

[ ] 用語と定義の明確化: 設計書内で使われる専門用語、略語、表の列名などが、一意に解釈できるよう定義されているか？（例：用語集の有無、各表の列定義の明確さ）

[ ] 異常系の網羅性: 正常系だけでなく、想定される異常系（入力エラー、外部APIエラー、タイムアウト、リソース枯渇等）がリストアップされ、それぞれの振る舞いが明確に定義されているか？テストケースに落とし込めるか？

DeepDive Module [T]: テスト設計可能性審査

/* このモジュールが有効化された場合、以下の追加指令を最高優先度で実行せよ */

[T1] 因子表（条件×値）: 各機能のテスト条件（因子）と、その値（水準）を一覧化せよ（同値、境界値、制約等）。

[T2] 決定表の網羅性: ビジネスルールを決定表に変換し、ルールの矛盾や到達不能なルールを指摘せよ。

[T3] 組合せ戦略: 複雑な機能に対し、適切な組合せテスト戦略（ペアワイズ法等）を提案し、テストケース数を見積もれ。

[T4] 状態モデル: 状態を持つ機能の状態遷移図/表を作成し、「状態,イベント,ガード条件,アクション,例外遷移」を網羅せよ。

[T5] データ契約の検証可能性: 入出力データの各フィールドの制約（データ型,桁数,NULL許容,相関制約等）を定義し、サンプルを提示せよ。

[T6] インタフェース試験観点: 各IFについて、「べき等性,再送処理,レート制限,エラーコード体系」等のテスト観点が設計書から読み取れるか評価せよ。

[T7] テスト不能箇所: 現状の設計書でテスト設計が困難な箇所を特定し、最低限必要な「補足情報リスト」を提示せよ。

DeepDive Module [TX]: 要件由来テスト因子・組合せ整合性

このモジュールが有効化された場合、以下の指令を最高優先度で実行せよ。

[TX1] 要件由来因子抽出: 要件定義の各項目からテスト設計に必要な入力条件（因子）を抽出し、「要件No／因子名／値（水準）／期待結果」を表形式で整理。

[TX2] 組合せ網羅性: 抽出した因子同士の相互依存関係を分析し、ペアワイズ法または決定表ベースで網羅率を算出。カバレッジが低い場合は「未網羅因子」として指摘。

[TX3] 検証不可能因子: 設計書に記述が不足し、テスト設計上「条件×値」の設定ができない箇所を列挙し、「要件No」「因子」「不足情報」「必要補足」をリストアップ。

Persona: CSharpTechLead (C#テックリード)

思考様式:

実装者の視点で設計書を読む。クリーンなコードが書けるか、パフォーマンスは出るか、.NETのベストプラクティスに沿っているかを重視する。「この設計で美しいコードが書けるか？」を問う。

指令 (Mission Checklist):

[ ] 実装の具体性: 設計からC#のクラスやメソッドが明確にイメージできるか？特定のライブラリ（例: Entity Framework）の作法に沿っているか？

[ ] コード品質リスク: 設計が複雑な依存関係や低凝集なコンポーネントを生み出さないか？（SOLID原則に反していないか？）

[ ] セキュリティとパフォーマンス: SQLインジェクション等の脆弱性や、ループ処理・データアクセスでの性能ボトルネックに繋がりそうな設計はないか？

** Persona: ProjectManager (プロジェクトマネージャー)**

思考様式:

リスク、スコープ、コスト、スケジュールの観点で設計書を読む。タスク分割と工数見積もりが可能か、手戻りリスクはないかを重視する。「この設計で見積もれるか？スコープは守られているか？」を問う。

指令 (Mission Checklist):

[ ] スコープの整合性: 設計されている全ての機能は、要件定義のスコープ内に収まっているか？オーバースペック（金メッキ）な部分はないか？

[ ] 見積もり可能性: 設計の各項目は、工数見積もりができる粒度で記述されているか？「要調査」「要検討」といった曖昧な記述が残っていないか？

[ ]  要求仕様との一致: 設計内容がルールブックで定義された要求や制約から逸脱していないか？

Persona: LanguageQualityReviewer (記述品質レビュアー)

思考様式:

文章の正確性・統一性・完全性を最優先に考える。 設計書を「人間およびAIが誤読せず、実装・テストに利用できる日本語仕様書」であるかを検証する。 特に誤字・脱字・文法破綻・表記揺れ・異言語混入を厳密に検出し、文脈的に正しい修正案を提示する。

指令 (Mission Checklist):

[ ] 記述品質チェック（誤字・脱字・用語混在検知）

設計書全体のテキストを解析し、以下のエラーを検出・分類せよ。

各検出結果は「箇所・原文・誤り分類・改善案・信頼度(0~1)」で表にまとめること。

単純誤字／漏字:

既知単語に類似するが1〜3文字異なる語（例：「プライン」→「プラグイン」）。

編集距離 ≤3 または音素一致率 ≥0.8 の語を「誤字疑い」として抽出。

動詞欠落・文末欠損:

「〜に」「〜を」「〜へ」などで終わる文を検出し、句末に動詞が存在しない場合、「意味破綻」として報告。

混在文字（異言語混入）:

日本語文中に中国語（例：「累计」）、技術用語以外の英語、半角カナ・全角英数字などが混在している箇所を検出。

文法破綻・助詞誤用:

不自然な助詞連結（例：「をを」）、述語が欠けている文などを「構文不整合」として報告。

用語不一致:

同一概念が複数の表記で出現している場合（例：「Excel／EXCEL／エクセル」）を確認し、正規表記案を提示。

** DeepDive Module [L]: 言語品質・可読性審査**

**[L1] 文体統一性:**設計書全体（本文、表内テキスト、引用符内のエラーメッセージ、図の注釈などを含む全ての日本語記述）で文体（「です／ます調」と「である／する調」）が統一されているか検証せよ。技術仕様書として「である／する調」への統一を原則とする。

[L2] 句読点・助詞チェック: 「、」の過剰／欠落、「は／が」「を／に」など助詞誤用を検出し、自然な修正案を提示せよ。

[L3] 技術用語の正規化: 業界標準表記（例：Excel、JSON、GCS、リポジトリ、トランゼクション）に準拠しているかを確認せよ。異表記を一覧化し、統一案を提示する。

[L4] 日本語以外の混在: 英語・中国語・半角カナなど異言語が混在している箇所を自動検出し、統一表記案を提示せよ。コード例・変数名などは例外とする。

===================================================

【4】出力形式 (Output Format)

===================================================

形式: 他のAIプラットフォームでも利用可能な、以下の指定されたモードに応じたテキストベースのテーブル形式で出力すること。

原則: ** 第１部 LanguageQualityReviewer (記述品質レビュアー)以外、各ペルソナの指令（Mission Checklist）項目を「要求内容」のベースとし、具体的な指摘事項を記述すること。

A) REVIEW_MODE: "InitialReview" (初回審査) の場合

【第1部：ペルソナ別レビュー結果】

| 要求No | 要求内容 (ペルソナ: 指令) | 評価 (〇/△/×) | 適合/不適合箇所 | 適合/不適合理由 | 修正案 (ゴールデンケースを含む) | 対応有無 | 対応方法／非対応理由 |

|:---|:---|:---|:---|:---|:---|:---|:---|

| SA-1 | SystemArchitect: 論理トレーサビリティ | △ | 3.1章 機能A | 要件定義書No.123から詳細設計への展開が追跡できない。中分類の設計が欠落している。 | (修正案を具体的に記述) | | |

| QA-1 | QAManager: WDT分析-「Do」の具体性 | × | 4.2.1 データ加工処理 | 処理内容が「マスタを参照して補正」としか書かれておらず、具体的な補正ロジックが不明。 |

【第2部：LanguageQualityReviewer (記述品質レビュアー)のレビュー結果】

| 箇所| 原文| 誤り分類| 改善案| 信頼度(0~1)| |:---|:---|:---|:---|:---| | 1.1章 p.5 | (原文テキスト) | (例: 用語不一致) | (例: 改善案テキスト) | 0.9 | | 2.3章 p.10 | (原文テキスト) | (例: 誤字疑い) | (例: 改善案テキスト) | 0.8 | | (以降、言語品質の指摘が続く) | | | | |

B) REVIEW_MODE: "DeltaCheck" (変更検証・複審) の場合

【最重要】 REVIEW_RESPONSE_SHEET (AI评审的修改方案文档) の各指摘事項に対する検証結果のみを、初回レビューと同一のフォーマットで、以下のマッピングルールに従って出力します。

【出力マッピングルール】

| 要求No |: REVIEW_RESPONSE_SHEET から 指摘No (または 要求No) を転記します。

| 要求内容 |: REVIEW_RESPONSE_SHEET から 要求内容 を転記します。

| 評価 (〇/△/×) |:

判定結果が OK の場合 → 〇

判定結果が NG の場合 → ×

判定結果が Partial の場合 → △

| 適合/不適合箇所 |: REVIEW_RESPONSE_SHEET から 箇所 を転記します。

| 適合/不適合理由 |: [AIによる検証コメントを記述]

〇 (対応済) の場合: 「対応方法 に基づき、v2設計書で修正が実行されたことを確認。」

〇 (非対応OK) の場合: 「非対応理由（例：顧客からの要求、業務規定、BL合意）が合理的かつ受諾可能であるため、v2設計書で変更がないことを確認。検証済とする。」

× (未対応) の場合: 「対応方法 に記載の修正が、v2設計書で実行されていない。未対応。」

△ (不十分) の場合: 「修正が不十分。（例：関連箇所の修正漏れあり）」

△ (非対応NG) の場合: 「非対応理由（例：後続タスクで対応）が客観的根拠に欠け、不十分である。リスクとして残存。」

| 修正案 (ゴールデンケースを含む) |:

〇 の場合: (検証済)

× or △ の場合: (v2設計書に対し、REVIEW_RESPONSE_SHEETの対応方法を再実行してください)

| 対応有無 |: REVIEW_RESPONSE_SHEET から 対応有無 を転記します。

| 対応方法／非対応理由 |: REVIEW_RESPONSE_SHEET から 対応方法／非対応理由 を転記します。

【変更検証・複審（DeltaCheck）レビュー結果】

| 要求No | 要求内容 (ペルソナ: 指令) | 評価 (〇/△/×) | 適合/不適合箇所 | 適合/不適合理由 | 修正案 (ゴールデンケースを含む) | 対応有無 | 対応方法／非対応理由 | |:---|:---|:---|:---|:---|:---|:---|:---| | QA-1 | QAManager: WDT分析-「Do」の具体性 | 〇 | 4.2.1 データ加工処理 | 「対応方法」に基づき、v2設計書 (4.2.1章) にて1〜3の番号付き処理ロジックが追加されたことを確認。 | (検証済) | 対応済 | 処理手順を番号付きで具体化する | | SA-1 | SystemArchitect: 論理トレーサビリティ | × | 3.1章 機能A | 「対応方法」に記載の「中分類の設計」が、v2設計書で実行されていない。未対応。 | (v2設計書に対し、REVIEW_RESPONSE_SHEETの対応方法を再実行してください) | 対応済 | 3.1.2章として中分類の設計を追加する | | PM-1 | ProjectManager: スコープの整合性 | △ | 5.5章, 2.1章 | 修正が不十分。5.5章は削除されているが、関連する2.1章「機能一覧」に「高度な検索」の記述が残存。 | (v2設計書に対し、REVIEW_RESPONSE_SHEETの対応方法を再実行してください) | 対応済 | 5.5章「高度な検索機能」を削除する | | QA-2 | QAManager: 異常系の網羅性 | 〇 | (該当箇所) | 非対応理由（BLとの合意）が妥当であるため、v2設計書で変更がないことを確認。検証済とする。 | (検証済) | 非対応 | 理由：BLとの合意により次期フェーズ対応とする。 | | QA-3 | QAManager: WDT分析 | △ | (該当箇所) | 非対応理由（後続タスクで対応）が不十分。設計上のリスクが残存するため、再検討が必要。 | (v2設計書に対し、REVIEW_RESPONSE_SHEETの対応方法を再実行してください) | 非対応 | 理由：後続タスクで対応。 | | (以降、対応表の全項目の検証結果が続く) | | | | | | | |



# PDF Content (Markdown format):


================================================================================
ドキュメント: プログラム基本設計書_基礎-コンポーネント_LogUtil_処理詳細_V2.pdf (PDF 1)
ファイル名: プログラム基本設計書_基礎-コンポーネント_LogUtil_処理詳細_V2.pdf
================================================================================

3-1.処理詳細説明(全体)

プログラムID

LogUtil

詳細内容

・目的

f013カタログ部品データ作成

システム名
業務機能名 基礎-コンポーネント
プログラム名称 LogUtil

システムID
バージョン
プロジェクトNo

作成日
更新日

2025/2/8

作成者
2025/10/30 更新者
区分

3H.薛宸
3H.薛宸

汎用

12000599-00

改訂No. 削

累積や累計などのPGに共通している部分を共通のDLLとして作成し、システムの安定性と開発効率を向上させる

・概要

システムにおける各種ログ出力の要件として、以下の出力先を実装する。

1 コンソール出力

アプリケーションの標準出力にログを出力する。
開発・デバッグ用途として利用し、

2 ログファイル出力

ログをファイルに記録し、システム運用時のトラブルシューティングや監査に活用する。
出力先のパス、ログのローテーション設定、および保持期間を適切に設計する。

3 クラウドロギング

CloudLoggingを使って、処理ログを指定の箇所に出力する。

・ログ出力制御ルール

LogType

メッセージタイプ

ログの種類

コンソールログ

ローカルログ Cloud Logging　※1

※1：常にスタックトレースを出す

Debug

Release

ERROR
WARNING
INFORMATION
PROCESS
STACKTRACE
ERROR
WARNING
INFORMATION
PROCESS
STACKTRACE

CloudLogging：

debug：

〇
〇
〇
〇
✖
〇
〇
〇
✖
✖

〇
〇
〇
〇
〇
〇
〇
〇
✖
✖

〇
〇
〇
〇
〇
〇
〇
〇
✖
〇

すべてのログを出力する

INFORMATION、PROCESS、WARNING、ERROR、STACKTRACE

release：

PROCESS以外のログを出力する

INFORMATION、WARNING、ERROR、STACKTRACE

ローカルログ：

ローカルログとして1つのファイルに出力し、ファイル名は「ツールID.log」(ツールIDは引数"logId"を使用)とする。

debug：

2
2

2

2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2

2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2

すべてのログを出力する

INFORMATION、PROCESS、WARNING、ERROR、STACKTRACE

release：

以下のログを出力する

INFORMATION、WARNING、ERROR、STACKTRACE

コンソールログ：

スタックトレースがコンソールログに出力されない

debug：

以下のログを出力する

INFORMATION、PROCESS、WARNING、ERROR

release：

以下のログを出力する

INFORMATION、WARNING、ERROR

・処理明細

各関数の動作を説明する。

クラス名:

ILog

機能:

インターフェースクラス。ログ出力を規格化するために使用されます。

①　関数: WriteLog

機能:

ログ出力のインターフェース関数。

void WriteLog(string msg, LogLevelEnum logLevel);

msg:ログ内容
logLevel:ログレベル

引数:

処理:

戻り値:

なし

異常処理:

②　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

2

2

2

戻り値:

なし

異常処理:

③　関数:

LogProcess

機能:

Processログ出力のインターフェース関数。

void LogProcess(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogInfo

機能:

Infoレベルのログ出力のインターフェース関数。

void LogInfo(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑤　関数:

LogWarn

機能:

Warnレベルのログ出力のインターフェース関数。

void LogWarn(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑥　関数:

LogError

機能:

Errorレベルのログ出力のインターフェース関数。

void LogError(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑦　関数:

LogException

機能:

異常情報出力のインターフェース関数。

void LogException(Exception ex);

引数:

ex:異常

処理:

戻り値:

なし

異常処理:

クラス名:

LogLevelEnum

機能:

列挙型クラス。ログレベルを定義する。

DEBUG
PROCESS
INFO
WARN
ERROR

クラス名:

AbstractLog

機能:

抽象クラス。ILogを継承し、ログ内容のフォーマットなどのメソッドを提供する。

①　関数: AbstractLog

機能:

コンストラクタ。ログ内容のタイトルをフォーマットする。

public AbstractLog(LogLabel logLabel，string logLevel)

引数:

logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

タイトルをフォーマットする。

2

2

2
2
2
2

2

戻り値:

なし

異常処理:

②　関数:

FormatMsg

機能:

ログ内容をフォーマットする。

public string FormatMsg(string msg, LogLevelEnum msgType)

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログ内容をフォーマットする。

戻り値:

string, フォーマットされたログ内容

異常処理:

③　関数: GetNowJapanDateTime

機能:

現在時刻(Japan)を取得する。

public DateTime GetNowJapanDateTime()

引数:

なし

処理:

現在時刻(Japan)の取得

戻り値:

DateTime:現在時刻(Japan)

異常処理:

④　関数:

IsDebugMode

機能:

デバッグモードかどうかを判定する

public bool IsDebugMode()

引数:

処理:

デバッグモードかどうかを判定する

戻り値:

logLevel が 「debug」の場合は true
「release」の場合は false

異常処理:

クラス名:

CloudLoggingUtil

機能:

AbstractLog抽象クラスを実装し、Cloudログを書き込むためのインターフェース関数をカプセル化する。

①　関数: CloudLoggingUtil

2
2
2
2
2
2
2
2
2
2
2
2
2

機能:

コンストラクタ。CloudLogging APIを初期化する。

public CloudLoggingUtil(string projectId, string logId, LogLabel logLabel,string logLevel) : base(loglabel,logLevel)

引数:

projectId:GCPプロジェクトID
logId:ログインスタンス名
logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

CloudLogging APIインスタンスを初期化する。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログをCloudに出力する。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

2
2
2
2
2

2

2

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

2

2
2

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

InfoレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

WarnレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

ErrorレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常情報をCloudに出力する。

戻り値:

なし

異常処理:

クラス名:

LogFileUtil

機能:

AbstractLog抽象クラスを実装し、ログファイルを書き込むためのインターフェース関数をカプセル化する。

①　関数:

LogFileUtil

機能:

コンストラクタ。ログディレクトリを初期化する。

public LogFileUtil(string logFilePath, LogLabel logLabel ,string logLevel) : base(logLabel,logLevel)

引数:

logFilePath:ログファイルのパス
logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

ログディレクトリを初期化します。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

処理:

msg:ログ内容
msgType:ログレベル

logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

戻り値:

なし

2
2
2
2
2

2
2

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログをファイルに出力する。

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

2

2

2

2

処理:

Warnレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常メッセージはreleaseログファイルに出力するが、スタックトレース情報はreleaseログファイルには出力しない。
logLevelが「debug」に設定されている場合は、異常メッセージおよびスタックトレース情報の両方をログファイルに出力する。

戻り値:

なし

異常処理:

クラス名:

ConsoleLoggingUtil

機能:

AbstractLog抽象クラスを実装し、コンソールログを書き込むためのインターフェース関数をカプセル化する。

①　関数: ConsoleLoggingUtil

機能:

コンストラクタ。

public ConsoleLoggingUtil(LogLabel logLabel,string logLevel) : base(logLabel,logLevel)

引数:

logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログレベル

2
2

2
2
2
2

2

処理:

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

処理:

msg:ログ内容
msgType:ログレベル

ログをコンソールに出力する。
logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログをコンソールに出力する。

戻り値:

なし

異常処理:

2
2

2

2

2

2

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

Warnレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力しする。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常（エラー）メッセージのみをコンソールに出力し、スタックトレースは出力しない。

2

戻り値:

なし

異常処理:

クラス名:

LogUtil

機能:

 ILogインターフェースを実装し、CloudLoggingUtil、LogFileUtil、ConsoleLoggingUtilを使用してログを書き込みます。

①　関数:

LogUtil

機能:

コンストラクタ。

public LogUtil(LogEntity log)

引数:

log:

projectId:GCPプロジェクトID
logId:ログインスタンス名
nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID
logFileFolderPath:ログファイル保存フォルダパス
logTypeList:出力ログタイプ
logLevel:ログの出力レベル

処理:

logTypeListに基づいて、必要に応じてCloudLoggingUtil、LogFileUtil、ConsoleLoggingUtilを作成する。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

2
2
2
2
2
2
2
2
2

2

2

2

2

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログを、Console以外の他の種類のログに出力する

・CloudlLogging
・Local

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

Warnレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常情報を必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:





================================================================================
ドキュメント: プログラム基本設計書_基礎-コンポーネント_LogUtil_処理詳細_V2.pdf (PDF 2)
ファイル名: プログラム基本設計書_基礎-コンポーネント_LogUtil_処理詳細_V2.pdf
================================================================================

3-1.処理詳細説明(全体)

プログラムID

LogUtil

詳細内容

・目的

f013カタログ部品データ作成

システム名
業務機能名 基礎-コンポーネント
プログラム名称 LogUtil

システムID
バージョン
プロジェクトNo

作成日
更新日

2025/2/8

作成者
2025/10/30 更新者
区分

3H.薛宸
3H.薛宸

汎用

12000599-00

改訂No. 削

累積や累計などのPGに共通している部分を共通のDLLとして作成し、システムの安定性と開発効率を向上させる

・概要

システムにおける各種ログ出力の要件として、以下の出力先を実装する。

1 コンソール出力

アプリケーションの標準出力にログを出力する。
開発・デバッグ用途として利用し、

2 ログファイル出力

ログをファイルに記録し、システム運用時のトラブルシューティングや監査に活用する。
出力先のパス、ログのローテーション設定、および保持期間を適切に設計する。

3 クラウドロギング

CloudLoggingを使って、処理ログを指定の箇所に出力する。

・ログ出力制御ルール

LogType

メッセージタイプ

ログの種類

コンソールログ

ローカルログ Cloud Logging　※1

※1：常にスタックトレースを出す

Debug

Release

ERROR
WARNING
INFORMATION
PROCESS
STACKTRACE
ERROR
WARNING
INFORMATION
PROCESS
STACKTRACE

CloudLogging：

debug：

〇
〇
〇
〇
✖
〇
〇
〇
✖
✖

〇
〇
〇
〇
〇
〇
〇
〇
✖
✖

〇
〇
〇
〇
〇
〇
〇
〇
✖
〇

すべてのログを出力する

INFORMATION、PROCESS、WARNING、ERROR、STACKTRACE

release：

PROCESS以外のログを出力する

INFORMATION、WARNING、ERROR、STACKTRACE

ローカルログ：

ローカルログとして1つのファイルに出力し、ファイル名は「ツールID.log」(ツールIDは引数"logId"を使用)とする。

debug：

2
2

2

2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2

2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2

すべてのログを出力する

INFORMATION、PROCESS、WARNING、ERROR、STACKTRACE

release：

以下のログを出力する

INFORMATION、WARNING、ERROR、STACKTRACE

コンソールログ：

スタックトレースがコンソールログに出力されない

debug：

以下のログを出力する

INFORMATION、PROCESS、WARNING、ERROR

release：

以下のログを出力する

INFORMATION、WARNING、ERROR

・処理明細

各関数の動作を説明する。

クラス名:

ILog

機能:

インターフェースクラス。ログ出力を規格化するために使用されます。

①　関数: WriteLog

機能:

ログ出力のインターフェース関数。

void WriteLog(string msg, LogLevelEnum logLevel);

msg:ログ内容
logLevel:ログレベル

引数:

処理:

戻り値:

なし

異常処理:

②　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

2

2

2

戻り値:

なし

異常処理:

③　関数:

LogProcess

機能:

Processログ出力のインターフェース関数。

void LogProcess(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogInfo

機能:

Infoレベルのログ出力のインターフェース関数。

void LogInfo(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑤　関数:

LogWarn

機能:

Warnレベルのログ出力のインターフェース関数。

void LogWarn(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑥　関数:

LogError

機能:

Errorレベルのログ出力のインターフェース関数。

void LogError(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑦　関数:

LogException

機能:

異常情報出力のインターフェース関数。

void LogException(Exception ex);

引数:

ex:異常

処理:

戻り値:

なし

異常処理:

クラス名:

LogLevelEnum

機能:

列挙型クラス。ログレベルを定義する。

DEBUG
PROCESS
INFO
WARN
ERROR

クラス名:

AbstractLog

機能:

抽象クラス。ILogを継承し、ログ内容のフォーマットなどのメソッドを提供する。

①　関数: AbstractLog

機能:

コンストラクタ。ログ内容のタイトルをフォーマットする。

public AbstractLog(LogLabel logLabel，string logLevel)

引数:

logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

タイトルをフォーマットする。

2

2

2
2
2
2

2

戻り値:

なし

異常処理:

②　関数:

FormatMsg

機能:

ログ内容をフォーマットする。

public string FormatMsg(string msg, LogLevelEnum msgType)

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログ内容をフォーマットする。

戻り値:

string, フォーマットされたログ内容

異常処理:

③　関数: GetNowJapanDateTime

機能:

現在時刻(Japan)を取得する。

public DateTime GetNowJapanDateTime()

引数:

なし

処理:

現在時刻(Japan)の取得

戻り値:

DateTime:現在時刻(Japan)

異常処理:

④　関数:

IsDebugMode

機能:

デバッグモードかどうかを判定する

public bool IsDebugMode()

引数:

処理:

デバッグモードかどうかを判定する

戻り値:

logLevel が 「debug」の場合は true
「release」の場合は false

異常処理:

クラス名:

CloudLoggingUtil

機能:

AbstractLog抽象クラスを実装し、Cloudログを書き込むためのインターフェース関数をカプセル化する。

①　関数: CloudLoggingUtil

2
2
2
2
2
2
2
2
2
2
2
2
2

機能:

コンストラクタ。CloudLogging APIを初期化する。

public CloudLoggingUtil(string projectId, string logId, LogLabel logLabel,string logLevel) : base(loglabel,logLevel)

引数:

projectId:GCPプロジェクトID
logId:ログインスタンス名
logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

CloudLogging APIインスタンスを初期化する。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログをCloudに出力する。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

2
2
2
2
2

2

2

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

2

2
2

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

InfoレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

WarnレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

ErrorレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常情報をCloudに出力する。

戻り値:

なし

異常処理:

クラス名:

LogFileUtil

機能:

AbstractLog抽象クラスを実装し、ログファイルを書き込むためのインターフェース関数をカプセル化する。

①　関数:

LogFileUtil

機能:

コンストラクタ。ログディレクトリを初期化する。

public LogFileUtil(string logFilePath, LogLabel logLabel ,string logLevel) : base(logLabel,logLevel)

引数:

logFilePath:ログファイルのパス
logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

ログディレクトリを初期化します。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

処理:

msg:ログ内容
msgType:ログレベル

logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

戻り値:

なし

2
2
2
2
2

2
2

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログをファイルに出力する。

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

2

2

2

2

処理:

Warnレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常メッセージはreleaseログファイルに出力するが、スタックトレース情報はreleaseログファイルには出力しない。
logLevelが「debug」に設定されている場合は、異常メッセージおよびスタックトレース情報の両方をログファイルに出力する。

戻り値:

なし

異常処理:

クラス名:

ConsoleLoggingUtil

機能:

AbstractLog抽象クラスを実装し、コンソールログを書き込むためのインターフェース関数をカプセル化する。

①　関数: ConsoleLoggingUtil

機能:

コンストラクタ。

public ConsoleLoggingUtil(LogLabel logLabel,string logLevel) : base(logLabel,logLevel)

引数:

logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログレベル

2
2

2
2
2
2

2

処理:

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

処理:

msg:ログ内容
msgType:ログレベル

ログをコンソールに出力する。
logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログをコンソールに出力する。

戻り値:

なし

異常処理:

2
2

2

2

2

2

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

Warnレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力しする。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常（エラー）メッセージのみをコンソールに出力し、スタックトレースは出力しない。

2

戻り値:

なし

異常処理:

クラス名:

LogUtil

機能:

 ILogインターフェースを実装し、CloudLoggingUtil、LogFileUtil、ConsoleLoggingUtilを使用してログを書き込みます。

①　関数:

LogUtil

機能:

コンストラクタ。

public LogUtil(LogEntity log)

引数:

log:

projectId:GCPプロジェクトID
logId:ログインスタンス名
nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID
logFileFolderPath:ログファイル保存フォルダパス
logTypeList:出力ログタイプ
logLevel:ログの出力レベル

処理:

logTypeListに基づいて、必要に応じてCloudLoggingUtil、LogFileUtil、ConsoleLoggingUtilを作成する。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

2
2
2
2
2
2
2
2
2

2

2

2

2

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログを、Console以外の他の種類のログに出力する

・CloudlLogging
・Local

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

Warnレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常情報を必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:





================================================================================
ドキュメント: プログラム基本設計書_基礎-コンポーネント_LogUtil_処理詳細_V1.pdf (PDF 3)
ファイル名: プログラム基本設計書_基礎-コンポーネント_LogUtil_処理詳細_V1.pdf
================================================================================

3-1.処理詳細説明(全体)

プログラムID

LogUtil

詳細内容

・目的

f013カタログ部品データ作成

システム名
業務機能名 基礎-コンポーネント
プログラム名称 LogUtil

システムID
バージョン
プロジェクトNo

作成日
更新日

2025/2/8

作成者
2025/10/30 更新者
区分

3H.薛宸
3H.薛宸

汎用

12000599-00

改訂No. 削

累積や累計などのPGに共通している部分を共通のDLLとして作成し、システムの安定性と開発効率を向上させる

・概要

システムにおける各種ログ出力の要件として、以下の出力先を実装する。

1 コンソール出力

アプリケーションの標準出力にログを出力する。
開発・デバッグ用途として利用し、

2 ログファイル出力

ログをファイルに記録し、システム運用時のトラブルシューティングや監査に活用する。
出力先のパス、ログのローテーション設定、および保持期間を適切に設計する。

3 クラウドロギング

CloudLoggingを使って、処理ログを指定の箇所に出力する。

・ログ出力制御ルール

LogType

メッセージタイプ

ログの種類

コンソールログ

ローカルログ Cloud Logging　※1

※1：常にスタックトレースを出す

Debug

Release

ERROR
WARNING
INFORMATION
PROCESS
STACKTRACE
ERROR
WARNING
INFORMATION
PROCESS
STACKTRACE

CloudLogging：

debug：

〇
〇
〇
〇
✖
〇
〇
〇
✖
✖

〇
〇
〇
〇
〇
〇
〇
〇
✖
✖

〇
〇
〇
〇
〇
〇
〇
〇
✖
〇

すべてのログを出力する

INFORMATION、PROCESS、WARNING、ERROR、STACKTRACE

release：

PROCESS以外のログを出力する

INFORMATION、WARNING、ERROR、STACKTRACE

ローカルログ：

ローカルログとして1つのファイルに出力し、ファイル名は『ツールID.log』とする。

debug：

2
2

2

2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2

2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2

すべてのログを出力する

INFORMATION、PROCESS、WARNING、ERROR、STACKTRACE

release：

以下のログを出力する

INFORMATION、WARNING、ERROR、STACKTRACE

コンソールログ：

スタックトレースがコンソールログに出力されない

debug：

以下のログを出力する

INFORMATION、PROCESS、WARNING、ERROR

release：

以下のログを出力する

INFORMATION、WARNING、ERROR

・処理明細

各関数の動作を説明する。

クラス名:

ILog

機能:

インターフェースクラス。ログ出力を規格化するために使用されます。

①　関数: WriteLog

機能:

ログ出力のインターフェース関数。

void WriteLog(string msg, LogLevelEnum logLevel);

msg:ログ内容
logLevel:ログレベル

引数:

処理:

戻り値:

なし

異常処理:

②　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

2

2

2

戻り値:

なし

異常処理:

③　関数:

LogProcess

機能:

Processログ出力のインターフェース関数。

void LogProcess(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogInfo

機能:

Infoレベルのログ出力のインターフェース関数。

void LogInfo(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑤　関数:

LogWarn

機能:

Warnレベルのログ出力のインターフェース関数。

void LogWarn(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑥　関数:

LogError

機能:

Errorレベルのログ出力のインターフェース関数。

void LogError(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

⑦　関数:

LogException

機能:

異常情報出力のインターフェース関数。

void LogException(Exception ex);

引数:

ex:異常

処理:

戻り値:

なし

異常処理:

クラス名:

LogLevelEnum

機能:

列挙型クラス。ログレベルを定義する。

DEBUG
PROCESS
INFO
WARN
ERROR

クラス名:

AbstractLog

機能:

抽象クラス。ILogを継承し、ログ内容のフォーマットなどのメソッドを提供する。

①　関数: AbstractLog

機能:

コンストラクタ。ログ内容のタイトルをフォーマットする。

public AbstractLog(LogLabel logLabel，string logLevel)

引数:

logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

タイトルをフォーマットする。

2

2

2
2
2
2

2

戻り値:

なし

異常処理:

②　関数:

FormatMsg

機能:

ログ内容をフォーマットする。

public string FormatMsg(string msg, LogLevelEnum msgType)

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログ内容をフォーマットする。

戻り値:

string, フォーマットされたログ内容

異常処理:

③　関数: GetNowJapanDateTime

機能:

現在時刻(Japan)を取得する。

public DateTime GetNowJapanDateTime()

引数:

なし

処理:

現在時刻(Japan)の取得

戻り値:

DateTime:現在時刻(Japan)

異常処理:

④　関数:

IsDebugMode

機能:

デバッグモードかどうかを判定する

public bool IsDebugMode()

引数:

処理:

デバッグモードかどうかを判定する

戻り値:

logLevel が 「debug」の場合は true
「release」の場合は false

異常処理:

クラス名:

CloudLoggingUtil

機能:

AbstractLog抽象クラスを実装し、Cloudログを書き込むためのインターフェース関数をカプセル化する。

①　関数: CloudLoggingUtil

2
2
2
2
2
2
2
2
2
2
2
2
2

機能:

コンストラクタ。CloudLogging APIを初期化する。

public CloudLoggingUtil(string projectId, string logId, LogLabel logLabel,string logLevel) : base(loglabel,logLevel)

引数:

projectId:GCPプロジェクトID
logId:ログインスタンス名
logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

CloudLogging APIインスタンスを初期化する。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログをCloudに出力する。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

2
2
2
2
2

2

2

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

2

2
2

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

InfoレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

WarnレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

ErrorレベルのログをCloudに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常情報をCloudに出力する。

戻り値:

なし

異常処理:

クラス名:

LogFileUtil

機能:

AbstractLog抽象クラスを実装し、ログファイルを書き込むためのインターフェース関数をカプセル化する。

①　関数:

LogFileUtil

機能:

コンストラクタ。ログディレクトリを初期化する。

public LogFileUtil(string logFilePath, LogLabel logLabel ,string logLevel) : base(logLabel,logLevel)

引数:

logFilePath:ログファイルのパス
logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログの出力レベル

処理:

ログディレクトリを初期化します。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

処理:

msg:ログ内容
msgType:ログレベル

logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

戻り値:

なし

2
2
2
2
2

2
2

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログをファイルに出力する。

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

2

2

2

2

処理:

Warnレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログをファイルに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常メッセージはreleaseログファイルに出力するが、スタックトレース情報はreleaseログファイルには出力しない。
logLevelが「debug」に設定されている場合は、異常メッセージおよびスタックトレース情報の両方をログファイルに出力する。

戻り値:

なし

異常処理:

クラス名:

ConsoleLoggingUtil

機能:

AbstractLog抽象クラスを実装し、コンソールログを書き込むためのインターフェース関数をカプセル化する。

①　関数: ConsoleLoggingUtil

機能:

コンストラクタ。

public ConsoleLoggingUtil(LogLabel logLabel,string logLevel) : base(logLabel,logLevel)

引数:

logLabel：

nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID

logLevel:ログレベル

2
2

2
2
2
2

2

処理:

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

処理:

msg:ログ内容
msgType:ログレベル

ログをコンソールに出力する。
logLevelが「release」に設定されている場合は、Processログを出力しません。
「debug」に設定されている場合は、Processログを出力します。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログをコンソールに出力する。

戻り値:

なし

異常処理:

2
2

2

2

2

2

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

Warnレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログをコンソールに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力しする。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常（エラー）メッセージのみをコンソールに出力し、スタックトレースは出力しない。

2

戻り値:

なし

異常処理:

クラス名:

LogUtil

機能:

 ILogインターフェースを実装し、CloudLoggingUtil、LogFileUtil、ConsoleLoggingUtilを使用してログを書き込みます。

①　関数:

LogUtil

機能:

コンストラクタ。

public LogUtil(LogEntity log)

引数:

log:

projectId:GCPプロジェクトID
logId:ログインスタンス名
nameSpace:ネームスペース
workFlowName:ワークフロー名
executeTaskId:実行タスクID
logFileFolderPath:ログファイル保存フォルダパス
logTypeList:出力ログタイプ
logLevel:ログの出力レベル

処理:

logTypeListに基づいて、必要に応じてCloudLoggingUtil、LogFileUtil、ConsoleLoggingUtilを作成する。

戻り値:

なし

異常処理:

②　関数: WriteLog

機能:

ログを出力する。

public override void WriteLog(string msg, LogLevelEnum msgType);

引数:

msg:ログ内容
msgType:ログレベル

処理:

ログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

③　関数:

LogDebug

機能:

Debugレベルのログ出力のインターフェース関数。

void LogDebug(string msg);

引数:

msg:ログ内容

2
2
2
2
2
2
2
2
2

2

2

2

2

処理:

戻り値:

なし

異常処理:

④　関数:

LogProcess

機能:

Processログを出力する。

public override void LogProcess(string msg);

引数:

msg:ログ内容

処理:

Processログを、Console以外の他の種類のログに出力する

・CloudlLogging
・Local

戻り値:

なし

異常処理:

⑤　関数:

LogInfo

機能:

Infoレベルのログを出力する。

public override void LogInfo(string msg);

引数:

msg:ログ内容

処理:

Infoレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑥　関数:

LogWarn

機能:

Warnレベルのログを出力する。

public override void LogWarn(string msg);

引数:

msg:ログ内容

処理:

Warnレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑦　関数:

LogError

機能:

Errorレベルのログを出力する。

public override void LogError(string msg);

引数:

msg:ログ内容

処理:

Errorレベルのログを必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:

⑧　関数:

LogException

機能:

異常情報を出力する。

public override void LogException(Exception ex);

引数:

ex:異常

処理:

異常情報を必要に応じてCloud、ファイル、コンソールに出力する。

戻り値:

なし

異常処理:



