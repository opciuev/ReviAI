審査ステップ 
1 事前準備：審査資料の整理 
・今回のテスト仕様書、前回のテスト仕様書（初回は不要）設計書、BLレビューと議事録、3H社内レビュー、AIレビューと担当者判断を用意（選択可能） 
・審査対象PDFに欠落・切れがないか目視で確認 
・PDFファイルが複雑な場合は、無料のオンラインPDF結合ツールを使用して一括で結合し、マッジしてからアップロード。 https://www.ilovepdf.com/ 

2 AIへの指示：審査条件を明示 
・審査対象（設計書のファイル名）を明示 
*前回テスト仕様書と今回テスト仕様書を区別 
・使用する審査項目（第1〜第5項＋拡張項目第6〜第8項）を指定し、それぞれの審査項目に対応する資料をアップロードする 
・必要であれば特定項目のみを絞って審査依頼も可能 
・プロンプトの指示とプロンプトの内容を使用 

3 出力データの整形と共有 
・AI出力結果をGoogleスプレッドシート形式でエクスポート 

4 審査結果の確認とレビュー 
・AI出力の評価結果（〇／△／×）を確認 
・不適合理由・修正案が妥当かを人の目でもチェック 
・審査結果をGoogleスプレッドシートに反映し、フォーマットを整えた上で、現在審査がサイクル内のどの段階にあるのかを明示してください。 

プロンプトの指示 
添付されたテスト仕様書の内容について、以下の審査項目に基づいて漏れなく審査を実施してください。可能であれば、最大限の計算リソースで審査を行ってください。 
以下の資料を参照してください： 

【参考資料】 
基本設計書：【ｘｘｘ基本設計書.pdf】 
前回の単体テスト仕様書：【ｘｘｘ.pdf】 
今回の単体テスト仕様書：【ｘｘｘ.pdf】 
最新のルールブック：【ｘｘ₋ルールブック.pdf】 
BLレビューと議事録：【BLレビューと議事録.ｐｄｆ】 
3H社内レビュー ：【3H社内レビュー.ｐｄｆ  】 
AIレビューと担当者判断：【AIレビューと担当者判断.ｐｄｆ】 

【出力形式】  
※ PDFファイルに切り取られた（途切れた）部分がある場合は、可能な限り内容をつなぎ合わせて審査してください。内容が判読できない場合は、その旨を明記してください。 
※ 以下のすべての審査項目は、Googleスプレッドシートにエクスポート可能な形式で提示してください。 

■ 評価結果表 
まず、AIは以下の8列の形式で初期レビュー結果を出力します。この時点では、7列目と8列目は常に空欄です。 
要求No｜要求内容｜評価（〇／△／×）｜適合/不適合箇所｜適合/不適合理由｜修正案｜対応有無｜対応方法／非対応理由 
1.各要求Noについて、省略せずに、以下3つのいずれかの評価を使用して評価してください： 
〇：適合 △：一部不適合 ×：不適合 
2.同じ要求Noに複数の不適合がある場合は、行を分けて記載 
3.「不適合箇所」は、セクション名・項番・キーワードなどで明確に特定すること 
4.「不適合理由」は、分かりやすく簡潔にまとめてください。 
5.「適合理由」は、任意で評価して構いませんが、今回が前回よりも改善されている場合は必ず評価を行ってください。  
6.「修正案」は、具体的かつ明確に提示してください。 
7.「対応有無」は、空欄にしてください。 
8.「対応方法／非対応理由」は、空欄にしてください。 
9.【拡張審査項目】の評価結果は、上記8点に加え、拡張審査項目の特有要件に従って出力してください。  

プロンプトの内容 
一、【審査項目と基準】 
■ 0. テスト設計の前提と戦略に関する要求（テスト設計可能性の審査） 
0.1 因子の分析と水準の定義（T1）: 各機能の可変条件（因子）と取りうる値（水準）が網羅的に洗い出され、同値クラス、境界値、デフォルト値、制約（排他・依存）が定義されているか。 
0.2 決定表による論理網羅性（T2）: 複雑なビジネスルールが決定表などを用いてモデル化され、ルールの矛盾、冗長性、欠落が分析されているか。 
0.3 組み合わせ戦略の妥当性（T3）: 因子が多い機能に対し、全網羅、ペアワイズ法、状態遷移網羅など、品質とコストのバランスを考慮した適切なテスト戦略が選択されているか。 
0.4 状態モデルの明確性（T4）: 状態を持つ機能について状態遷移モデルが定義され、正常遷移、異常遷移、禁止遷移、タイムアウトなどが明確になっているか。 
0.5 データ契約の検証可能性（T5）: 入出力データの各フィールドの制約（型、桁、精度、NULL可否、相関など）がテスト可能な形で定義されているか。 
0.6 インターフェースの試験観点（T6）: APIやバッチ等のインターフェースについて、冪等性、再送、リトライ、レート制限といった、非機能要件を含むテスト観点が定義され、観測可能になっているか。 
0.7 テスト不能箇所の特定（T7）: 仕様の不足などによりテスト設計が不可能な箇所が特定され、必要な追加情報がリストアップされているか。 

■ 1. 論理構成と明確性に関する要求 
1.1各テストケースにおいて、「①前提条件」「②操作手順」「③期待結果」が具体的に記述され、因果関係が明確であるか。また、その前提条件が、基本設計書に記載された設計制約や仕様に基づいているか。 
1.2 曖昧な表現（例：「うまく」「必要に応じて」）が使われていないか。 
1.3 期待結果が「どのように・何を確認すべきか」まで明確に記述され、目視／ログ／DBなどの検証手段が示されているか。 

■ 2. 簡潔性に関する要求 
2.1 専門用語・略語・外来語の使用が適切かつ一貫している 
2.2 分かりやすい用語を使用している 
2.3 評価に影響を与えない装飾語・曖昧な修飾表現が除去されている 
2.4 テストケースは、読み手が一読して理解できる粒度・長さで説明されている 
2.5 冗長な記述がない 
2.6 重複表現がない 
2.7 客観的に記述されている 
2.8 説明的・叙述的に記述されている 
2.9 受動態が使用されている 
2.10 一人称表現（「我々」など）を使用していない 
2.11 文体（「です・ます」体と「である」体）が統一されている 
2.12 表記揺れ（例：「ログ出力」vs「ログの出力」）が存在しない 

■ 3. 内容の整合性に関する要求 
3.1 見出しに階層構造を用いているか 
3.2 階層は4段階以内か 
3.3 見出しの階層順に矛盾がないか 
3.4 前後のテストケース間に論理矛盾がないか 
3.5 見出しと本文の内容に技術的な齟齬がないか 
3.6 重要なテストデータは図や表で整理されているか 
3.7 セクションの分類構造が番号体系と対応しており、番号の抜け・重複・順序の乱れがないかを確認すること 
3.8 「大分類・中分類・小分類・テスト条件・仕様」などの分類構造が、論理的かつ一貫しており、項目間の関係性に矛盾がないかを確認すること 

■ 4. 品質の担保と再現性に関する要求 
4.1 操作手順の再現性: 第三者でも実行可能なレベルで操作手順が記述されているか 
4.2 検証手段の明示: UI、ログ、DB など、期待結果の検証手段が明示されているか 
4.3 期待結果の明確性: 合否を客観的に判断できる定量的・具体的な記述となっているか 
4.4 テスト資産の再利用性: スクリプト・テストデータが将来の再利用を考慮しているか 
4.5 実行環境の明示: 対象バージョンや実行環境が明示されており、依存関係も考慮されているか 
4.6 異常時ログ・エラー出力の検証: エラー発生時のログ出力／エラーメッセージが仕様通りに記録・表示されるか 
4.7 テストの実行方法の明示: 各テストが手動実行か、自動化されたテストコードによる実行かが明確に区別・記述されているか 

■ 5. テスト設計の妥当性と網羅性に関する要求 
5.1 設計仕様との整合性と実装の反映: 基本設計書に記載された仕様をテストで網羅しているか。特に、テストケースが、仕様を実現するために実装された主要な処理や権限要求を正確に反映しているか 
5.2 テスト観点の網羅性: 正常系／異常系・例外系／境界値がバランスよく含まれているか 
5.3 テストデータの妥当性: 使用するテストデータが目的に応じて適切に選定されているか 
5.4 テストの独立性: 各テストケースが他の実行順序に依存せず、単独で実行可能になっているか 
5.5 入力仕様の網羅性: テスト対象への入力（設定ファイル等）自体の仕様（必須項目、データ型、許容値、フォーマット、大文字/小文字の区別等）に対するテスト観点が十分に考慮されているか 

■ 6. ルールブックとの整合性に関する要求 
6.1 【ルールブックとの全体整合性】：テスト仕様書全体（テストケース、テストデータ、期待結果を含む）が、共通ルールブックに定められた開発規約、命名規則、標準仕様と整合しているか。 
6.2 【エラーハンドリングとログ出力の規約】：ルールブックに共通のエラーハンドリングやログ出力（例：フォーマット、必須出力項目、ログレベル）に関する規約が定義されている場合、テストケースがそれらの規約通りに動作することを網羅的に検証しているか。 
6.3 【設定ファイルと起動パラメータの規約】：ルールブックに設定ファイル（例：命名規則、共通設定と個別設定の上書き順序）や起動パラメータに関する共通規約が定義されている場合、テストケースがその規約に従った動作を検証しているか。 
6.4 【データ処理・変換の共通ルール】：ルールブックにデータ操作に関する共通ルール（例：データ型ごとの初期値、項目マッピングの標準方式、共通の変換・計算関数など）が定義されている場合、テストケースがそれらのルールに基づいたデータ処理を網羅的に検証しているか。 
6.5 【アーキテクチャ・設計原則の規約】：ルールブックに、モジュール間の連携方法や責務の分離といったアーキテクチャ上の設計原則が定義されている場合、テストケースがその原則を遵守していることを（MockやStubの利用を通じて）検証しているか。 

※第7～第9項は【拡張審査項目】であり、【BLレビューと議事録】／【3H社内レビュー  】／【AIレビューと担当者判断】 に基づくものです。 

二、【拡張審査項目】 

■7. BLレビューと議事録 
内容 
本項目は、前回のテスト仕様書に対して、BL（顧客）が実施したレビュー指摘とその議事録をまとめたもの。 
審査方法 
今回のテスト仕様書において、BLからの指摘内容に対応できているかを確認する。 
出力形式 
「審査項目と基準」に基づき、BLの指摘内容を審査観点として抽出し、【第6項】として評価する。 
【要求No】：BLレビューまとめの番号順に並べてください  
【要求内容】：BLレビューまとめの内容をそのままコピーしてください  
【評価】：BLレビューまとめの内容に対応しているかどうかを確認し、今回のテスト仕様書について評価結果（〇／△／×）を記載してください  
【適合/不適合理由】：対応済みである理由、または未対応の理由を分析して簡潔に記載してください  
【修正案】：未対応の理由に基づき、具体的な修正案を提示してください  

■ 8. 3H社内レビュー  
内容 
本項目は、前回のテスト仕様書に対して、BLレビュー後に、3H社内で実施された再レビューによる指摘内容のまとめ。 
審査方法 
今回のテスト仕様書において、社内からの指摘内容に対応できているかを確認する。 
出力形式 
「審査項目と基準」に基づき、社内指摘を審査観点として抽出し、【第7項】として評価する。 
【要求No】：社内レビューまとめの番号順に並べてください  
【要求内容】：社内レビューまとめの内容をそのままコピーしてください  
【評価】：社内レビューまとめの内容に対応しているかどうかを確認し、今回のテスト仕様書について評価結果（〇／△／×）を記載してください  
【適合/不適合理由】：対応済みである理由、または未対応の理由を分析して簡潔に記載してください  
【修正案】：未対応の理由に基づき、具体的な修正案を提示してください  

■9. AIレビューと担当者判断 
内容 
本項目は、前回の審査において「△」または「×」と評価された審査項目に対し、担当者が「非対応」と判断した場合、その対応方法または非対応理由について再審査を行う。 
審査方法 
① 担当者の理由が妥当な場合：前回評価の「△」または「×」を、今回評価の「〇」に変更してください。 
【適合/不適合理由】には【AIによる承認理由】として、「非対応」の判断が妥当と見なされる根拠を具体的に記述してください。 
以下の観点は一例であり、すべてのケースを網羅するものではない： 
ビジネス上の判断：プロジェクトのスコープ外、コスト対効果に見合わない、納期優先など 
技術的な制約：使用ライブラリの制限、プラットフォームの仕様などにより物理的な対応が困難 
代替策の提示：指摘されたリスクに対して、設計変更以外の方法（例：運用カバー）で十分に対応可能 
影響の軽微性：指摘内容が、システムの動作や品質に与える影響が極めて軽微である 
② 担当者の理由が妥当でない場合：前回評価の「△」または「×」を今回も維持してください。 
【適合/不適合理由】には【AIによる再反論】として、提示された理由が不十分である根拠や、依然として残るリスクを具体的に記述し、新たな修正案を提示してください。 
出力形式 
「審査項目と基準」に基づき、担当者の判断結果を審査観点として抽出し、【第8項】として評価を行ってください。 
【要求No】：初回審査時のNoを含めて（括弧で）記載してください 
【要求内容】：初回と同一の内容を記載してください 
【評価】：今回の評価結果（〇／△／×）を記載してください 
【適合/不適合理由】：【AIによる承認理由】または【AIによる再反論】として記述してください 
【修正案】：担当者が前回の修正案に対応していない場合は前回の修正案を維持し、意見がある場合はその内容を踏まえた新たな修正案を提示してください 

# PDF Content (Markdown format):


================================================================================
ドキュメント: プログラム基本設計書_B145_累積作成_f013WEBカタログ部品情報EXCELファイル解析_処理詳細_V7.pdf (今回の設計書 V7)
ファイル名: プログラム基本設計書_B145_累積作成_f013WEBカタログ部品情報EXCELファイル解析_処理詳細_V7.pdf
================================================================================

3-1.処理詳細説明(全体)

システム名
業務機能名

f013カタログ部品データ作成
累積ツール

プログラムID

f013-parts-list-excel-parser

プログラム名称 f013WEBカタログ部品情報EXCELファイル解析

システムID
バージョン
プロジェクトNo

12000599-00

作成日
更新日

2025/1/8
2025/10/30
区分

作成者
更新者

専用

3H.尚坤
3H.尚坤

詳細内容

・解析プラグイン定義

f013WEBカタログ部品情報excelファイル解析機能は、SON形式の引数をもとに必要な情報を抽出し、部品一覧Excelファイルを読んで、レコード単位で戻します。

各プラグインは、以下の3段階処理（Before／Main／After）を通じてデータ解析を実施する。

前処理段階 (Before)
本処理段階 (Main)
後処理段階 (After)

実行環境の初期化、入力引数（JSON）の解析、指定ファイルの存在チェック等を行う。
部品一覧Excelファイルを読み込み、解析結果をレコード単位でコールバックメソッドへ返却する。
処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

・API定義

public void Before(string pluginParamJson,LogUtil logUtil)

引数：

pluginParamJson

logUtil(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)(cid:9)

戻り値：

なし

プラグイン実行に必要な情報を格納したJSON文字列。
※詳細レイアウトは「プログラム基本設計書_プラグイン振分モジュール_解析加工IF定義」を参照。

LogUtilインスタンス
※ログ出力を行うための LogUtil インスタンス。

public void Main(Action<DataRow> onDataRow)

引数：

onDataRow

戻り値：

なし

public int After(out string jsonMessage)

引数：

jsonMessgae

戻り値：

レコードを逐次返却する用コールバック
※読み取ったレコードを一つずつ返却するコールバック

異常ありの場合、最後に発生したエラーのメッセージをJSON形式で返却する引数
DataLineageExecuteLogのdetail_message情報を更新するために使用される。

＞　正常終了の場合、 ExitCode=0
＞　異常発生の場合、最後に発生したエラーの ExitCode

・処理詳細

1. 前処理段階 (Before)

実行環境の初期化、入力引数（JSON）の解析、指定ファイルの存在チェック等を行う。

1.1 起動ログ情報の出力

プラグインの実行開始ログを出力する

INFO タイプ： 「f013WEBカタログ部品情報excelファイル解析」プラグインを開始します...

プロセスログ

PROCESS タイプ： 前処理(Beforeメソッド) 実行

1.2 入力引数の解析

引数 pluginParamJson のJSON形式文字列から、使用する情報を解析します。

プロセスログ

PROCESS タイプ：引数（JSON）内容の解析

1.3 入力引数の内容チェック

指定された Input スキーマファイルに対して、柔軟に対応できるように、最小限の妥当性チェックだけを実施します。
LineageId をもとに転記仕様 YAML（transformYamlInfoDic）から該当のInputスキーマファイルを取得します。
必要な項目IDが含まれているかを確認します。

プロセスログ

PROCESS タイプ： 指定のInputスキーマファイル「{schemaPath}」のチェック 実行

1.3.1  項目IDチェック

・チェック対象は、必須項目である「項目ID」(item_id) の存在確認に限定します。
＞　Inputスキーマファイルに、定義された必須項目 IDが存在しない場合、

エラーログを出力する（ExitCode：253）

ERROR タイプ： 当リネージID「xxxx」の「リソース管理テーブル」にて、指定されたInputスキーマYamlファイル:「xxxx」に、必須項目「xxxx」がないです。

必須項目一覧（本プラグインで定義される項目）：

改訂No. 削

9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9

9
9
9

9

9
9
9

9
9
9
9

項目№
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26

項目ID
f013_acquisition_date
f013_main_group_code
f013_main_group
f013_sub_group_code
f013_sub_group
f013_service_parts_news
f013_parts_name_code
f013_parts_number
f013_parts_name
f013_parts_quantity
f013_parts_price_group
f013_genuine_parts_price
f013_parts_specific information
f013_parts_remarks
f013_parts_maker_code
f013_supply_mode
f013_options
f013_supply_alt_parts_number
f013_supply_alt_parts_maker_code
f013_supply_alt_parts_price_group
f013_supply_alt_parts_price
f013_parts_start_date
f013_parts_end_date
f013_d2s_protal_name
f013_car_model
f013_car_model_classification_code

項目名
f013・取得日
f013・メイングループコード
f013・メイングループ
f013・サブグループコード
f013・サブグループ
f013・サービスパーツニュース(SPN)
f013・品名コード
f013・部品番号
f013・部品名称
f013・部品数量
f013・部品価格グループ
f013・MFTBC価格
f013・部品固有情報
f013・部品備考
f013・部品メーカーコード
f013・部品供給モード
f013・部品オプション
f013・供給代替部品番号
f013・供給代替部品メーカーコード
f013・供給代替部品価格グループ
f013・供給代替部品希望小売価格
f013・部品開始日
f013・部品終了日
f013・D2S部品提供名称
f013・車両モデル
f013・類別コード

・それ以外の項目（例：項目名、項目順、型、項目長など）については、個別の検証は行いません。

1.4 入力ファイルチェック
プロセスログ

PROCESS タイプ： 部品情報excelファイル「{excelFilePath}」のファイルチェック 実行

1.4.1 入力ファイル命名規則に必須のマクロ変数が含まれているかのチェック

＞ 入力ファイル命名規則に必須マクロ変数が定義されていない場合：

エラーログを出力する（ExitCode：252）

ERROR タイプ： 当リネージID「{lineageId}」の「リソース管理」テーブルにて、指定された入力ファイル命名規則「{fileNameRule}」に必須マクロ変数「{macroName}」がないです。

1.4.2 入力ファイルの存在チェック

＞　入力ファイルが存在しない場合：

エラーログを出力する（ExitCode：245）

ERROR タイプ： 対象データファイル「{excelFilePath}」が見つかりません。

1.4.4 Excelファイル 0 バイトチェック

· 入力データとしてExcelファイルのサイズを確認し、0 バイトの場合は破損ファイルと見なして処理を中断、

エラーログを出力する（ExitCode：243）

ERROR タイプ： 対象データファイル「{excelFilePath}」が0バイトで、累積処理を実行できません。

1.4.3 Excel ファイルをOpenして、レイアウトをチェックする

1.4.3.1 対応バージョン

Excel 2003形式（.xls）および2007以降の形式（.xlsx）の両方に対応しています。

1.4.3.2 Excelファイルの読み込み

Excelファイルは、ローカルまたは GCS上に格納されている可能性があるため、以下の方法で処理を行う。

ExcelDataReader を使用して読み込みます。
＞ Local

ローカルファイルは そのまま直接読み込み。

＞ GCS

GCS からファイルをダウンロードせずに、ストリーム経由で読み込みます。

1.4.4.3 ExcelDataReaderによる終了行判定

· 読み込み範囲の基準

Excelシート内の「使用されたセル範囲（Used Range）」を基準に読み込みます。
Used Rangeはデータや書式が設定されている範囲です。

· 読み取りの範囲

内部的に認識されるUsed Rangeの最終行および最終列までデータを読み取ります。
空白行や空白セルが途中にあっても、その時点で読み取りを終了しません。

1.4.4.4 Excelファイルレイアウトのチェック

Excelファイルの構造（カラム）が、本プラグインで処理可能なカラムと一致するかをチェックする。

※本プラグインで処理対象となるExcelファイルの構造（カラム）は、以下の固定構造に従うものとする。

列№

列名

9

9
9
9

9
9

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21

メイングループ
サブグループ
SPN
PNC (品名コード)
部品番号
Part desc
数量
価格グループ
MFTBC Price
固有情報
備考
メーカーコード
供給モード
オプション
Supply Alt. Part No.
ﾒｰｶｰｺｰﾄﾞ
代替品を供給 価格グループ
供給代替希望小売価格
開始日
終了日
D2S Protalの名称

1.4.4.5 シート数のチェック

＞　複数のシートが存在する場合は、

エラーログを出力する（ExitCode：242）

ERROR タイプ： 対象データファイル「{excelFilePath}」に複数のシートが存在します。1つシートのExcelファイルのみ処理可能です。

1.4.4.6 カラム数のチェック

＞　一致しない場合は、下記のエラーメッセージを表示し、

エラーログを出力する（ExitCode：242）

ERROR タイプ： 対象データファイル「{excelFilePath}」の項目数「{actualColumnNameList.Count}」が、プラグイン「f013WEBカタログ部品情報excelファイル解析」で処理可能項目数「{excelHeaderList.Count}」と一致しません。

1.4.4.7 カラム名称・順序のチェック

＞　一致しない場合は、下記のエラーメッセージを表示し、

エラーログを出力する（ExitCode：242）

ERROR タイプ： 対象データファイル「{excelFilePath}」の第「{i + 1}」列の項目IDは、プラグイン「f013WEBカタログ部品情報excelファイル解析」に定義済みの項目ID:「{excelHeaderList[i]}」ではなく、「{actualColumnNameList[i]}」です。

2. 本処理段階 (Main)

部品一覧Excelファイルを読み込み、解析結果をレコード単位でコールバックメソッドへ返却する。

2.1 前処理段階 (Before)の結果判定:

ExitCode 情報に基づき、前処理段階 (Before) の実行結果を判断します。

＞ 前処理段階（Before）で Error が発生した場合

本処理段階(Main) の実行を スキップ します。
プロセスは直接後処理段階（After）に移行し、該当する例外結果を返却します。

＞ 前処理段階（Before）で Error が発生しなかった場合

後続処理を 続行 します。

2.2 Excelファイルをリードして、指定の加工をする

プロセスログ

PROCESS タイプ： 本処理(Mainメソッド) 実行

2.2.1 項目のマッピングとカラム操作

・項目のマッピングとカラム操作

Excelファイルの列とInputスキーマ定義列のマッピング(本ツール内で固定処理として定義する)

Excel解析スキーマ：
f013_main_group
f013_sub_group
f013_service_parts_news
f013_parts_name_code
f013_parts_number
f013_parts_name
f013_parts_quantity
f013_parts_price_group
f013_genuine_parts_price
f013_parts_specific information
f013_parts_remarks

←
←
←
←
←
←
←
←
←
←
←

Excelの列：
メイングループ
サブグループ
SPN
PNC (品名コード)
部品番号
Part desc
数量
価格グループ
MFTBC Price
固有情報
備考

カラム操作
-
-
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム、ただし、トリム後空文字になる場合は1バイトのスペースを設定する
前後トリム
前後トリム
前後トリム

9
9
9

9
9
9

9
9
9

9
9
9
9

9
9
9
9
9
9

f013_parts_maker_code
f013_supply_mode
f013_options
f013_supply_alt_parts_number
f013_supply_alt_parts_maker_code
f013_supply_alt_parts_price_group
f013_supply_alt_parts_price
f013_parts_start_date
f013_parts_end_date
f013_d2s_protal_name

2.2.2 固定値の設定

・下記項目の値を固定値に設定します

f013_car_model
f013_car_model_classification_code
f013_acquisition_date
f013_main_group_code
f013_sub_group_code

←
←
←
←
←
←
←
←
←
←

←
←
←
←
←

メーカーコード
供給モード
オプション
Supply Alt. Part No.
ﾒｰｶｰｺｰﾄﾞ
代替品を供給 価格グループ
供給代替希望小売価格
開始日
終了日
D2S Protalの名称

前後トリム
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム、ただし、トリム後空文字になる場合は1バイトのスペースを設定する
前後トリム
前後トリム
前後トリム
前後トリム

部品一覧Excelファイル名から車両モデル「!FS_CAR_MODEL!」
部品一覧Excelファイル名から類別コード「!FS_CAR_MODEL_CLSSFN!」
部品一覧Excelファイル名から抽出日「!ACQUISITION_YYYYMMDD!」
部品一覧Excelファイル名からメイングループコード「!FS_MAINGRP_CD!」
部品一覧Excelファイル名からサブグループコード「!FS_SUBGRP_CD!」

※Inputスキーマレイアウトが上記定義内容と異なる場合の対応：
  ・項目長の変更

元データの長さチェックをしなくて、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・項目データ型の変更

元データの型チェックをしなくて（string 型として扱うため）、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・新規項目の場合、

上記にない項目については、このプラグインで値をセットしない場合、Inputスキーマで定義されたタイプに応じた初期値が設定されます。
別の初期値が必要な場合は、このプラグインのソースコードを変更する必要があります。

27

f013_xxxx_aaa

←

項目のタイプに応じた初期値を設定
※詳細は、ルールブックのシート「4)データの転記」内の「4　スキーマYAML定義におけるデータ型別初期値」を参照。

2.2.3 エラーデータの処理

レコードのエラーは、エラーハンドリング設定に従って対応されます。

エラーハンドリングモード一覧
エラーハンドリング

resume

skip

terminate

2.3 解析結果の返却

処理方法
エラーレコードをスキップし、次のレコードから処理を続行します。（ExitCode：124）
エラーメッセージを出力し
現在ファイルをスキップします。（ExitCode：124）
エラーメッセージを出力し

エラーメッセージを出力し、全処理を終了します。（ExitCode：255）

LineageIDに対応する入力スキーマレイアウトに従い、DataRow形式の解析結果データをコールバック方式（onDataRow）で呼び出し元に逐次返却します。

プロセスログ

正常件数：{normalCount}
異常件数：{errorCount}

3. 後処理段階 (After)

処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

プロセスログ

PROCESS タイプ： 後処理(Afterメソッド) 実行

3.1 処理完了時に、実行結果ログを出力する。

メッセージ:

> 正常完了

INFO タイプ： 「f013WEBカタログ部品情報excelファイル解析」が正常完了しました。

> 異常終了

ERROR タイプ： 「f013WEBカタログ部品情報excelファイル解析」が異常終了しました。

3.2 ExitCodeおよびメッセージ情報の返却

＞　正常終了の場合、ExitCode=0 でリターン、jsonMessageは空です。
＞　異常発生の場合、最後のエラーに対する ExitCode とエラー情報を返却する

9
9
9
9

9
9
9
9
9
9
9

9
9





================================================================================
ドキュメント: プログラム基本設計書_B145_累積作成_f013WEBカタログ部品情報EXCELファイル解析_処理詳細_V6.pdf (前回の設計書 V6)
ファイル名: プログラム基本設計書_B145_累積作成_f013WEBカタログ部品情報EXCELファイル解析_処理詳細_V6.pdf
================================================================================

3-1.処理詳細説明(全体)

システム名 f013カタログ部品データ作成
業務機能名 累積ツール

プログラムID f013-parts-list-excel-parser プログラム名称 f013WEBカタログ部品情報excelファイル解析

システムID
バージョン
プロジェクトNo

作成日
更新日

12000599-00

2025/1/8
2025/10/19
区分

作成者
更新者

専用

3H.尚坤
3H.尚坤

詳細内容

・解析プラグイン定義

振分モジュールでは、JSON形式の引数をもとに必要な情報を抽出し、部品一覧Excelファイルを読み込みます。

各プラグインは、以下の3段階処理（Before／Main／After）を通じてデータ解析を実施する。

前処理段階 (Before)
本処理段階 (Main)
後処理段階 (After)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。
部品一覧Excelファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。
処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

・API定義

public Before(string pluginParamJson)

パラメータ：

pluginParamJson

戻り値：

プラグイン実行に必要な情報を格納したJSON文字列。
※詳細レイアウトは「プログラム基本設計書_プラグイン振分モジュール_解析加工IF定義」を参照。

チェック結果

ExitCode およびメッセージ情報（msgId, msg）を返却。

public Main(Action<DataRow> onDataRow)

レコードを逐次返却する用コールバック
※読み取ったレコードを一つずつ返却するコールバック

パラメータ：

onDataRow

戻り値：
なし

public After()
戻り値：

＞　正常終了の場合、 ExitCode=0 を返却する
＞　異常発生の場合、最後のエラーに対する ExitCode とエラー情報を返却する

・処理詳細

1. DLL初期化

「LogUtility」を使用し、ログ出力に関する設定を初期化する。
「f013WEBカタログ部品情報excelファイル解析」の固有メッセージの定義ファイルを読み込み、ログメッセージのロードを行う。

詳細は LogUtilityのNewWriter()/SetMessageTemplates(string filePath)を参照する。

2. 前処理段階 (Before)

実行環境の初期化、入力パラメータ（JSON）の解析、指定ファイルの存在チェック等を行う。

2.1 起動ログ情報の出力

プラグインの実行開始ログを出力する

出力内容
msgId
CI0001_AppStarted

メッセージテンプレート
「{0}」を開始します...

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null) を参照する。

2.2 パラメータの解析

パラメータ pluginParamJson のJSON形式文字列から、使用する情報を解析します。

2.3 リネージ設定情報チェック

指定された Input スキーマファイルに対して、柔軟に対応できるように、最小限の妥当性チェックだけを実施します。
LineageId をもとに転記仕様 YAML（transformYamlInfoDic）から該当のInputスキーマファイルを取得します。
必要な項目IDが含まれているかを確認します。

2.4.1  項目IDチェック

・チェック対象は、必須項目である「項目ID」(item_id) の存在確認に限定します。
＞　Inputスキーマファイルに、定義された必須項目 IDが存在しない場合、

エラーログを出力する（ExitCode：253）

出力内容
msgId

メッセージテンプレート

CE0020_MissingRequiredIt
emInSchema

当リネージID「{0}」の「リソース管理テーブル」にて、指定されたInputスキーマYamlファイル:「{1}」に、必須項目「{2}」がないで
す。

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

説明
0: f013WEBカタログ部品情報excelファイル解析

説明
0：現在処理のリネージID
1：スキーマファイルの名称
2：項目ID

改訂No. 削

9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9

9
9
9

9

9

9
9
9
9
9
9

9

9
9
9
9
9
9
9
9
9
9
9
9
9
9
9

9

9

必須項目一覧（本プラグインで定義される項目）：
項目№ 項目ID
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26

f013_acquisition_date
f013_main_group_code
f013_main_group
f013_sub_group_code
f013_sub_group
f013_service_parts_news
f013_parts_name_code
f013_parts_number
f013_parts_name
f013_parts_quantity
f013_parts_price_group
f013_genuine_parts_price
f013_parts_specific information
f013_parts_remarks
f013_parts_maker_code
f013_supply_mode
f013_options
f013_supply_alt_parts_number
f013_supply_alt_parts_maker_code
f013_supply_alt_parts_price_group
f013_supply_alt_parts_price
f013_parts_start_date
f013_parts_end_date
f013_d2s_protal_name
f013_car_model
f013_car_model_classification_code

項目名
f013・取得日
f013・メイングループコード
f013・メイングループ
f013・サブグループコード
f013・サブグループ
f013・サービスパーツニュース(SPN)
f013・品名コード
f013・部品番号
f013・部品名称
f013・部品数量
f013・部品価格グループ
f013・MFTBC価格
f013・部品固有情報
f013・部品備考
f013・部品メーカーコード
f013・部品供給モード
f013・部品オプション
f013・供給代替部品番号
f013・供給代替部品メーカーコード
f013・供給代替部品価格グループ
f013・供給代替部品希望小売価格
f013・部品開始日
f013・部品終了日
f013・D2S部品提供名称
f013・車両モデル
f013・類別コード

・それ以外の項目（例：項目名、項目順、型、項目長など）については、個別の検証は行いません。

2.4 入力ファイルチェック

2.4.1  入力ファイル名が命名規則に従っているかのチェック
＞　入力ファイル名が命名規則に従っていない場合：

エラーログを出力する（ExitCode：244）

出力内容
msgId

メッセージテンプレート

説明

CE0021_DataFileNamingR
uleMismatch

対象データファイル「{0}」は、当リネージの命名規則「{1}」に適合しません。

0：入力ファイルフルパス
1：リソース管理テーブル定義の名称ルール(repository+filenamerule)

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

2.4.2  入力ファイル命名規則に必須のマクロ変数が含まれているかのチェック
＞　入力ファイル命名規則に必須マクロ変数が定義されていない場合：

エラーログを出力する（ExitCode：253）

出力内容
msgId

メッセージテンプレート

CE0023_MissingRequired
MacroVariable

当リネージID「{0}」の「リソース管理」テーブルにて、指定された入力ファイル命名規則「{1}」に必須マクロ変数「{2}」がないです
。

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

2.4.3 入力ファイルの存在チェック

＞　入力ファイルが存在しない場合：

エラーログを出力する（ExitCode：244）

出力内容
msgId

CE0022_DataFileNotFoun
d

メッセージテンプレート

対象データファイル「{0}」が見つかりません。

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

2.4.4 Excelファイル 0 バイトチェック

· 入力データとしてExcelファイルのサイズを確認し、0 バイトの場合は破損ファイルと見なして処理を中断、

エラーログを出力する（ExitCode：244）

出力内容

説明

0：現在処理のリネージID
1：入力ファイルの名称ルール
2：必須マクロ変数の名称

説明

0：入力ファイルのフルパス

9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9

9

9

9
9
9
9
9
9

9

9

9
9
9
9
9
9

9

9
9

9
9
9
9
9

説明

0：入力ファイルのフルパス

msgId
CE0024_DataFileZeroByte
s

メッセージテンプレート

対象データファイル「{0}」が0バイトで、累積処理を実行できません。

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

2.4.5 Excel ファイルをOpenして、レイアウトをチェックする

2.4.5.1 対応バージョン

Excel 2003形式（.xls）および2007以降の形式（.xlsx）の両方に対応しています。

2.4.5.2 Excelファイルの読み込み

Excelファイルは、ローカルまたは GCS上に格納されている可能性があるため、以下の方法で処理を行う。

ExcelDataReader を使用して読み込みます。
＞ Local

ローカルファイルは そのまま直接読み込み。

＞ GCS

GCS からファイルをダウンロードせずに、ストリーム経由で読み込みます。

2.4.5.3 ExcelDataReaderによる終了行判定

· 読み込み範囲の基準

Excelシート内の「使用されたセル範囲（Used Range）」を基準に読み込みます。
Used Rangeはデータや書式が設定されている範囲です。

· 読み取りの範囲

内部的に認識されるUsed Rangeの最終行および最終列までデータを読み取ります。
空白行や空白セルが途中にあっても、その時点で読み取りを終了しません。

2.4.5.4 Excelファイルレイアウトのチェック

Excelファイルの構造（カラム）が、本プラグインで処理可能なカラムと一致するかをチェックする。

※本プラグインで処理対象となるExcelファイルの構造（カラム）は、以下の固定構造に従うものとする。

列№ 列名
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21

メイングループ
サブグループ
SPN
PNC (品名コード)
部品番号
Part desc
数量
価格グループ
MFTBC Price
固有情報
備考
メーカーコード
供給モード
オプション
Supply Alt. Part No.
ﾒｰｶｰｺｰﾄﾞ
代替品を供給 価格グループ
供給代替希望小売価格
開始日
終了日
D2S Protalの名称

2.4.5.5 シート数のチェック

＞　複数のシートが存在する場合は、

エラーログを出力する（ExitCode：242）

出力内容
msgId
SE0001_MultipleSheetsExi
st

メッセージテンプレート

説明

対象データファイル「{0}」に複数のシートが存在します。1つシートのExcelファイルのみ処理可能です。

0：入力ファイルのフルパス

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

2.4.5.6 カラム数のチェック

＞　一致しない場合は、下記のエラーメッセージを表示し、

エラーログを出力する（ExitCode：242）

出力内容
msgId

メッセージテンプレート

SE0001_MultipleSheetsExi
st

対象データファイル「{0}」の項目数「{1}」が、プラグイン「f013WEBカタログ部品情報excelファイル解析」で処理可
能項目数「{2}」と一致しません。

説明

0：入力ファイルExcelのフルパス
1：Excelファイルシートの列数
2：専用プラグインで解析可能なファイル列数

9

9

9
9

9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9

9

9
9

9
9
9
9
9
9

9

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

2.4.5.7 カラム名称・順序のチェック

＞　一致しない場合は、下記のエラーメッセージを表示し、

エラーログを出力する（ExitCode：242）

出力内容
msgId

メッセージテンプレート

SE0001_MultipleSheetsExi
st

対象データファイル「{0}」の第「{1}」列の項目IDは、
 プラグイン「f013WEBカタログ部品情報excelファイル解析」に定義済みの項目ID:「{1}」ではなく、「{3}」です。

説明
0：入力ファイルExcelのフルパス
1：項目列数
2：Excelファイルシートの列名称
3：専用プラグインで解析可能なファイル列名称

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null)を参照する。

3. 本処理段階 (Main)

部品一覧Excelファイルを読み込み、解析結果をレコード単位でコールバック関数へ返却する。

3.1 Excelファイルをリードして、指定の加工をする

3.1.1 項目のマッピングとカラム操作

・項目のマッピングとカラム操作

Excelファイルの列とInputスキーマ定義列のマッピング(本ツール内で固定処理として定義する)

Excel解析スキーマ：
f013_main_group
f013_sub_group
f013_service_parts_news
f013_parts_name_code
f013_parts_number
f013_parts_name
f013_parts_quantity
f013_parts_price_group
f013_genuine_parts_price
f013_parts_specific information
f013_parts_remarks
f013_parts_maker_code
f013_supply_mode
f013_options
f013_supply_alt_parts_number
f013_supply_alt_parts_maker_code
f013_supply_alt_parts_price_group
f013_supply_alt_parts_price
f013_parts_start_date
f013_parts_end_date
f013_d2s_protal_name

3.1.2 固定値の設定

・下記項目の値を固定値に設定します

f013_car_model
f013_car_model_classification_code
f013_acquisition_date
f013_main_group_code
f013_sub_group_code

←
←
←
←
←
←
←
←
←
←
←
←
←
←
←
←
←
←
←
←
←

←
←
←
←
←

Excelの列：
メイングループ
サブグループ
SPN
PNC (品名コード)
部品番号
Part desc
数量
価格グループ
MFTBC Price
固有情報
備考
メーカーコード
供給モード
オプション
Supply Alt. Part No.
ﾒｰｶｰｺｰﾄﾞ
代替品を供給 価格グループ
供給代替希望小売価格
開始日
終了日
D2S Protalの名称

カラム操作
-
-
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム、ただし、トリム後空文字になる場合は1バイトのスペースを設定する
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム
前後トリム、ただし、トリム後空文字になる場合は1バイトのスペースを設定する
前後トリム
前後トリム
前後トリム
前後トリム

部品一覧Excelファイル名から車両モデル「!FS_CAR_MODEL!」
部品一覧Excelファイル名から類別コード「!FS_CAR_MODEL_CLSSFN!」
部品一覧Excelファイル名から抽出日「!ACQUISITION_YYYYMMDD!」
部品一覧Excelファイル名からメイングループコード「!FS_MAINGRP_CD!」
部品一覧Excelファイル名からサブグループコード「!FS_SUBGRP_CD!」

※Inputスキーマレイアウトが上記定義内容と異なる場合の対応：
  ・項目長の変更

元データの長さチェックをしなくて、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・項目データ型の変更

元データの型チェックをしなくて（string 型として扱うため）、呼出し側のコンバート処理にて実施する。プラグイン側に特に何もする必要なし

  ・新規項目の場合、

上記にない項目については、このプラグインで値をセットしない場合、Inputスキーマで定義されたタイプに応じた初期値が設定されます。
別の初期値が必要な場合は、このプラグインのソースコードを変更する必要があります。

27

f013_xxxx_aaa

3.1.3 エラーデータの処理

←

項目のタイプに応じた初期値を設定
※詳細は、ルールブックのシート「4)データの転記」内の「4　スキーマYAML定義におけるデータ型別初期値」を参照。

レコードのエラーは、エラーハンドリング設定に従って対応されます。

エラーハンドリングモード一覧
エラーハンドリング

resume

処理方法
エラーレコードをスキップし、次のレコードから処理を続行します。（ExitCode：124）
エラーメッセージを出力し

9
9
9
9
9

9
9
9

9

9
9

9

9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9
9

9

skip

terminate

3.2 解析結果の返却

現在ファイルをスキップします。（ExitCode：124）
エラーメッセージを出力し

エラーメッセージを出力し、全処理を終了します。（ExitCode：255）

LineageIDに対応する入力スキーマレイアウトに従い、DataRow形式の解析結果データをコールバック方式（onDataRow）で呼び出し元に逐次返却します。

4. 後処理段階 (After)

処理結果の集計およびリソース解放を行い、最終的な終了コード（ExitCode）とメッセージ情報を返却する。

4.1 処理完了時に、実行結果ログを出力する。

出力内容
区分

msgId

メッセージテンプレート

正常完了 CI0006_AppSuccess

「{0}」が正常完了しました。

異常終了 CI0007_AppFailure

「{0}」が異常終了しました。エラー内容: {1}

詳細は LogUtilityのWrite(string msgId, List<string> paramList,Exception? exception = null) を参照する。

4.2 ExitCodeおよびメッセージ情報の返却

＞　正常終了の場合、 ExitCode=0 を返却する
＞　異常発生の場合、最後のエラーに対する ExitCode とエラー情報を返却する

説明

0: サブグループ別部品情報リストPDFファイルレコード生成

0: サブグループ別部品情報リストPDFファイルレコード生成
1: 例外メッセージ（Exception.Message）

9

9

9
9
9
9
9
9
9
9
9
9
9
9

9

9

9
9

9
9



